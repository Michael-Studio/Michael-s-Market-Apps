<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storage Tycoon</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background-color: #0a0a12;
            color: #0f0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 40, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 30, 60, 0.1) 0%, transparent 20%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            border: 2px solid #0f0;
            border-radius: 5px;
            background-color: rgba(0, 20, 0, 0.7);
            box-shadow: 
                0 0 15px rgba(0, 255, 0, 0.3),
                inset 0 0 15px rgba(0, 255, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .screen::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                rgba(10, 20, 10, 0.1) 50%,
                rgba(0, 0, 0, 0.25) 50%
            );
            background-size: 100% 4px;
            z-index: 1;
            pointer-events: none;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
        h1, h2, h3, h4 {
            color: #0f0;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
            margin-bottom: 15px;
        }

        h1 {
            font-size: 2.5rem;
            text-align: center;
            padding: 10px;
            border-bottom: 1px solid #0f0;
            background-color: rgba(0, 30, 0, 0.5);
        }

        h2 {
            font-size: 1.8rem;
            padding: 8px;
            border-bottom: 1px solid #0a0;
        }

        h3 {
            font-size: 1.4rem;
            color: #8f8;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            background-color: #003300;
            color: #0f0;
            border: 1px solid #0a0;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.2s;
            border-radius: 3px;
        }

        button:hover {
            background-color: #005500;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background-color: #002200;
            color: #080;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-primary {
            background-color: #004400;
            font-size: 1.2rem;
            padding: 12px 25px;
        }

        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        .start-screen {
            max-width: 800px;
            margin: 50px auto;
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1rem;
            color: #8f8;
        }

        input, select {
            width: 100%;
            padding: 10px;
            background-color: #001100;
            border: 1px solid #0a0;
            color: #0f0;
            font-size: 1rem;
        }

        input:focus, select:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .country-info {
            background-color: rgba(0, 30, 0, 0.3);
            padding: 15px;
            margin-top: 10px;
            border-left: 3px solid #0f0;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .game-container {
            display: none;
            grid-template-columns: 300px 1fr 300px;
            grid-template-rows: auto 1fr;
            gap: 15px;
            min-height: calc(100vh - 40px);
        }

        /* ==================== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ==================== */
        .top-panel {
            grid-column: 1 / span 3;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: rgba(0, 30, 0, 0.5);
            border-bottom: 1px solid #0a0;
            min-height: 100px;
            flex-wrap: wrap;
            gap: 20px;
        }

        /* –ö–æ–º–ø–∞–Ω–∏—è */
        .company-info {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
            padding: 5px 10px;
        }

        .company-info h3 {
            color: #0f0;
            font-size: 1.4rem;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .company-info p {
            color: #8f8;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .game-stats {
            display: flex;
            gap: 25px;
            flex: 2;
            justify-content: center;
            flex-wrap: wrap;
            min-width: 0;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 90px;
            padding: 10px 15px;
            background: rgba(0, 40, 0, 0.3);
            border-radius: 8px;
            border: 1px solid #0a0;
            flex-shrink: 0;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #8f8;
            margin-bottom: 8px;
            text-align: center;
            white-space: nowrap;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #0f0;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            min-width: 70px;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .game-controls {
            flex: 1;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
            min-width: 250px;
        }

        .game-controls button {
            padding: 9px 14px;
            font-size: 0.95rem;
            min-width: 70px;
            flex-shrink: 0;
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è */
        .left-panel {
            padding: 15px;
            overflow-y: auto;
        }

        .tech-list {
            margin-top: 20px;
        }

        .tech-item {
            background-color: rgba(0, 20, 0, 0.5);
            border: 1px solid #0a0;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 3px;
        }

        .tech-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .tech-year {
            color: #8f8;
            font-size: 0.9rem;
        }

        .tech-cost {
            color: #ff8;
            font-size: 0.9rem;
            margin: 5px 0;
        }

        /* ==================== –í–ö–õ–ê–î–ö–ò –° –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ú –°–ö–†–û–õ–õ–û–ú ==================== */
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
        .tabs-container {
            width: 100%;
            margin-bottom: 20px;
            position: relative;
        }

        /* –°–∞–º–∏ –≤–∫–ª–∞–¥–∫–∏ - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –í–°–ï–ì–î–ê –í–ò–î–ï–ù */
        .tabs {
            display: flex;
            overflow-x: scroll !important;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: auto;
            scrollbar-color: #0f0 #001100;
            white-space: nowrap;
            padding-bottom: 12px;
            border-bottom: 2px solid #0a0;
        }

        /* –Ø—Ä–∫–∏–π –∑–∞–º–µ—Ç–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        .tabs::-webkit-scrollbar {
            height: 10px !important;
            background: #001100 !important;
            border: 2px solid #0a0 !important;
            border-radius: 5px !important;
        }

        .tabs::-webkit-scrollbar-track {
            background: #001100 !important;
            border-radius: 5px !important;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: #0f0 !important;
            border-radius: 5px !important;
            border: 2px solid #001100 !important;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.8) !important;
            min-height: 30px;
        }

        .tabs::-webkit-scrollbar-thumb:hover {
            background: #0c0 !important;
        }

        /* –û—Ç–¥–µ–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ */
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background-color: #002200;
            border: 1px solid #0a0;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            flex-shrink: 0;
            font-size: 1rem;
            color: #8f8;
            transition: all 0.3s;
            min-width: 170px;
            text-align: center;
        }

        .tab:hover {
            background-color: #003300;
            color: #0f0;
        }

        .tab.active {
            background-color: #004400;
            color: #0f0;
            border-color: #0f0;
            border-bottom: 1px solid #004400;
            margin-bottom: -1px;
            position: relative;
            z-index: 2;
        }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .center-panel {
            padding: 15px;
            overflow-y: auto;
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
        .tab-content {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
            padding: 20px 0;
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: fadeInTab 0.4s ease;
        }

        @keyframes fadeInTab {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* –°–µ—Ç–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .product-card {
            background-color: rgba(0, 20, 0, 0.5);
            border: 1px solid #0a0;
            padding: 15px;
            border-radius: 3px;
        }

        .product-model {
            font-weight: bold;
            color: #8f8;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .product-specs {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .spec {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .spec-value {
            font-weight: bold;
            color: #0f0;
        }

        .spec-label {
            font-size: 0.8rem;
            color: #8f8;
        }

        .price-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .price-input {
            flex: 1;
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .right-panel {
            padding: 15px;
            overflow-y: auto;
        }

        .finance-stats {
            background-color: rgba(0, 20, 0, 0.5);
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #0a0;
            border-radius: 3px;
        }

        .finance-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .finance-label {
            color: #8f8;
        }

        .finance-value {
            color: #0f0;
            font-weight: bold;
        }

        .positive {
            color: #0f0;
        }

        .negative {
            color: #f00;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #001100;
            border: 2px solid #0f0;
            border-radius: 5px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #0f0;
            cursor: pointer;
        }

        .slider-container {
            margin-bottom: 20px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        input[type="range"] {
            width: 100%;
            height: 10px;
            background: #002200;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #0f0;
            cursor: pointer;
            border-radius: 50%;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #003300;
            border: 1px solid #0f0;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
            z-index: 10001;
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-title {
            font-weight: bold;
            color: #0f0;
            margin-bottom: 5px;
        }

        /* –ì—Ä–∞—Ñ–∏–∫ */
        .chart-container {
            background-color: rgba(0, 20, 0, 0.3);
            padding: 15px;
            border-radius: 3px;
            margin-top: 20px;
        }

        canvas {
            width: 100%;
            height: 200px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã */
        .security-warning {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border: 2px solid #ff9900;
        }

        .captcha-modal {
            background: rgba(0, 0, 0, 0.95);
            z-index: 100000;
        }

        .captcha-code {
            font-family: monospace;
            font-size: 2rem;
            letter-spacing: 10px;
            text-align: center;
            padding: 20px;
            background: #001100;
            border: 2px solid #0f0;
            margin: 20px 0;
        }

        /* ==================== –ú–û–ë–ò–õ–¨–ù–´–ï –°–¢–ò–õ–ò ==================== */
        @media (max-width: 1200px) {
            .game-container {
                grid-template-columns: 250px 1fr 250px;
            }
            
            .top-panel {
                gap: 15px;
                padding: 12px 15px;
            }
            
            .game-stats {
                gap: 20px;
            }
            
            .stat {
                min-width: 85px;
                padding: 8px 12px;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            .stat-value {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 992px) {
            .game-container {
                grid-template-columns: 220px 1fr 220px;
            }
            
            .top-panel {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .company-info {
                max-width: 100%;
                text-align: center;
                order: 1;
            }
            
            .game-stats {
                order: 2;
                justify-content: space-around;
                width: 100%;
                gap: 15px;
            }
            
            .game-controls {
                order: 3;
                justify-content: center;
                width: 100%;
            }
            
            .stat {
                flex: 1;
                min-width: auto;
                max-width: 130px;
            }
            
            .tab {
                min-width: 160px;
                padding: 10px 20px;
            }
        }

        @media (max-width: 768px) {
            /* –î–µ–ª–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫ */
            .game-container {
                display: block !important;
                grid-template-columns: 1fr !important;
                grid-template-rows: auto !important;
                min-height: auto;
                gap: 15px;
                padding: 10px !important;
            }
            
            /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .top-panel {
                padding: 15px;
                min-height: auto;
                gap: 15px;
            }
            
            .company-info h3 {
                font-size: 1.3rem;
            }
            
            .company-info p {
                font-size: 0.9rem;
            }
            
            /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Å–µ—Ç–∫–µ 4x1 –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö */
            .game-stats {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 10px !important;
                width: 100%;
            }
            
            .stat {
                padding: 10px 8px;
                background: rgba(0, 30, 0, 0.4);
                border-radius: 6px;
                min-width: 0;
            }
            
            .stat-label {
                font-size: 0.75rem;
                margin-bottom: 5px;
            }
            
            .stat-value {
                font-size: 1rem;
                min-width: 0;
            }
            
            /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Å–µ—Ç–∫–µ */
            .game-controls {
                display: grid !important;
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 8px !important;
                width: 100%;
            }
            
            .game-controls button {
                padding: 10px 8px;
                font-size: 0.85rem;
                min-width: 0;
                text-align: center;
            }
            
            /* –í—Å–µ –ø–∞–Ω–µ–ª–∏ –∏–¥—É—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
            .left-panel,
            .center-panel,
            .right-panel {
                width: 100% !important;
                max-width: 100% !important;
                margin-bottom: 20px !important;
                display: block !important;
                padding: 15px !important;
            }
            
            .left-panel .screen,
            .center-panel .screen,
            .right-panel .screen {
                height: auto !important;
                min-height: 350px;
                max-height: none !important;
                margin-bottom: 0;
            }
            
            /* –í–∫–ª–∞–¥–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .tabs {
                margin-bottom: 15px;
                padding-bottom: 10px;
            }
            
            .tab {
                min-width: 150px;
                padding: 10px 18px;
                font-size: 0.95rem;
            }
            
            /* –ü—Ä–æ–¥—É–∫—Ç—ã –≤ –æ–¥–Ω—É –∫–æ–ª–æ–Ω–∫—É */
            .product-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }
            
            .product-card {
                padding: 15px;
            }
            
            /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã */
            .container {
                padding: 10px !important;
            }
            
            h1 {
                font-size: 2rem;
                padding: 15px 10px;
            }
            
            h2 {
                font-size: 1.5rem;
                padding: 10px;
            }
            
            h3 {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 576px) {
            .game-stats {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px !important;
            }
            
            .game-controls {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 6px !important;
            }
            
            .stat {
                padding: 12px 8px;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .stat-value {
                font-size: 0.95rem;
            }
            
            .game-controls button {
                padding: 9px 6px;
                font-size: 0.8rem;
            }
            
            .tab {
                min-width: 140px;
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .product-card {
                padding: 12px;
            }
            
            /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
            .start-screen {
                margin: 20px auto;
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 400px) {
            .game-stats {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
            }
            
            .game-controls {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 5px !important;
            }
            
            .stat {
                padding: 10px 6px;
            }
            
            .stat-label {
                font-size: 0.65rem;
            }
            
            .stat-value {
                font-size: 0.9rem;
            }
            
            .game-controls button {
                padding: 8px 4px;
                font-size: 0.75rem;
            }
            
            .tab {
                min-width: 130px;
                padding: 7px 12px;
                font-size: 0.85rem;
            }
        }

        /* –§–∏–∫—Å –¥–ª—è iOS */
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: -webkit-fill-available;
            }
            
            .game-container {
                min-height: -webkit-fill-available;
            }
            
            /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑—É–º –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ */
            input, select, textarea {
                font-size: 16px !important;
            }
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (min-height: 900px) {
            .left-panel,
            .right-panel,
            .center-panel {
                max-height: 75vh;
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã */
        @keyframes gameAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .game-container.active {
            animation: gameAppear 0.5s ease;
        }

        /* –£–ª—É—á—à–∞–µ–º —Å–∫—Ä–æ–ª–ª –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .left-panel,
        .right-panel,
        .center-panel {
            scrollbar-width: thin;
            scrollbar-color: #0a0 #001100;
        }

        .left-panel::-webkit-scrollbar,
        .right-panel::-webkit-scrollbar,
        .center-panel::-webkit-scrollbar {
            width: 8px;
        }

        .left-panel::-webkit-scrollbar-track,
        .right-panel::-webkit-scrollbar-track,
        .center-panel::-webkit-scrollbar-track {
            background: #001100;
        }

        .left-panel::-webkit-scrollbar-thumb,
        .right-panel::-webkit-scrollbar-thumb,
        .center-panel::-webkit-scrollbar-thumb {
            background-color: #0a0;
            border-radius: 4px;
        }

        /* –£–ª—É—á—à–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–æ–∫—É—Å–∞ */
        button:focus-visible, 
        input:focus-visible,
        select:focus-visible {
            outline: 2px solid #0f0;
            outline-offset: 2px;
        }

        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            * {
                -webkit-tap-highlight-color: transparent;
            }
        }
    </style>
</head>
<body>
    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="container">
        <div class="start-screen screen">
            <h1>STORAGE TYCOON</h1>
            <p style="text-align: center; margin-bottom: 30px; color: #8f8; font-size: 1.1rem;">
                –ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø—É—Ç—å –≤ 1980 –≥–æ–¥—É –∫–∞–∫ —Å—Ç–∞—Ä—Ç–∞–ø-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–µ–π –¥–ª—è –ü–ö.<br>
                –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –∏–º–ø–µ—Ä–∏—é, –ø—Ä–æ–π–¥—è –ø—É—Ç—å –æ—Ç –ø—Ä–æ—Å—Ç–µ–π—à–∏—Ö –º–æ–¥—É–ª–µ–π –ø–∞–º—è—Ç–∏ –¥–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö SSD.
            </p>
            
            <div class="form-group">
                <label for="companyName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                <input type="text" id="companyName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏" value="DataKeeper Inc.">
            </div>
            
            <div class="form-group">
                <label for="ceoName">–ò–º—è CEO</label>
                <input type="text" id="ceoName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" value="–ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤">
            </div>
            
            <div class="form-group">
                <label for="country">–°—Ç—Ä–∞–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label>
                <select id="country">
                    <!-- –°—Ç—Ä–∞–Ω—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
                </select>
                
                <div class="country-info">
                    <p id="countryDetails">–°–®–ê: –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª $50,000, –Ω–∞–ª–æ–≥ 25%. –ë–æ–ª—å—à–æ–π —Ä—ã–Ω–æ–∫ —Å–±—ã—Ç–∞.</p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button id="startGame" class="btn-primary">–ù–∞—á–∞—Ç—å –¥–µ–ª–æ!</button>
            </div>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div class="game-container container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
        <div class="top-panel screen">
            <div class="company-info">
                <h3 id="currentCompanyName">DataKeeper Inc.</h3>
                <p id="currentCeoName">CEO: –ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤</p>
            </div>
            
            <div class="game-stats">
                <div class="stat">
                    <span class="stat-label">–î–ê–¢–ê</span>
                    <span class="stat-value" id="currentDate">01.01.1980</span>
                </div>
                <div class="stat">
                    <span class="stat-label">–ë–ê–õ–ê–ù–°</span>
                    <span class="stat-value" id="currentBalance">$50,000</span>
                </div>
                <div class="stat">
                    <span class="stat-label">–û–ü–´–¢</span>
                    <span class="stat-value" id="currentXP">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">–ö–í–ê–†–¢–ê–õ</span>
                    <span class="stat-value" id="currentQuarter">Q1</span>
                </div>
                <div class="stat">
                    <span class="stat-label">–°–¢–†–ê–ù–ê</span>
                    <span class="stat-value" id="currentCountry">–°–®–ê</span>
                </div>
            </div>
            
            <div class="game-controls">
                <button id="pauseBtn">–ü–∞—É–∑–∞</button>
                <button id="saveGameBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="loadGameBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                <button id="resetGameBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
                <!-- <button id="soundToggle">üîä</button> -->
                <button id="about">–û –∏–≥—Ä–µ</button>
            </div>
        </div>
        
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="left-panel screen">
            <h2>–ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø –ò –ü–†–û–ò–ó–í–û–î–°–¢–í–û</h2>
            <div class="tech-list" id="techList">
                <!-- –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="center-panel screen">
            <div class="tabs">
                <div class="tab active" data-tab="store">–ú–û–ô –ú–ê–ì–ê–ó–ò–ù</div>
                <div class="tab" data-tab="marketing">–ú–ê–†–ö–ï–¢–ò–ù–ì</div>
                <div class="tab" data-tab="production">–ü–†–û–ò–ó–í–û–î–°–¢–í–û</div>
                <div class="tab" data-tab="achievements">–î–û–°–¢–ò–ñ–ï–ù–ò–Ø</div>
                <!-- <div class="tab" data-tab="market">–ú–ê–ì–ê–ó–ò–ù–´</div> -->
            </div>
            
            <div id="storeTab" class="tab-content active">
                <h3>–ú–æ–¥–µ–ª–∏ –≤ –ø—Ä–æ–¥–∞–∂–µ</h3>
                <div class="product-grid" id="storeProducts">
                    <p id="noProductsMsg">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ø—Ä–æ–¥–∞–∂–µ.</p>
                </div>
            </div>

            <div id="marketTab">

            </div>
            
            <div id="marketingTab" class="tab-content">
                <h3>–†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏</h3>
                <div id="marketingCampaigns"></div>
                
                <div class="chart-container">
                    <h4>–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂</h4>
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
            
            <div id="productionTab" class="tab-content">
                <h3>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏</h3>
                <div id="productionInterface"></div>
            </div>
            
            <div id="achievementsTab" class="tab-content">
                <h3>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                <div id="achievementsList"></div>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="right-panel screen">
            <h2>–§–ò–ù–ê–ù–°–´ –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h2>
            
            <div class="finance-stats">
                <h4>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á—ë—Ç</h4>
                <div class="finance-item">
                    <span class="finance-label">–î–æ—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥:</span>
                    <span class="finance-value positive" id="periodIncome">$0</span>
                </div>
                <div class="finance-item">
                    <span class="finance-label">–†–∞—Å—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥:</span>
                    <span class="finance-value negative" id="periodExpense">$0</span>
                </div>
                <div class="finance-item">
                    <span class="finance-label">–ü—Ä–∏–±—ã–ª—å –¥–æ –Ω–∞–ª–æ–≥–æ–≤:</span>
                    <span class="finance-value" id="periodProfit">$0</span>
                </div>
                <div class="finance-item">
                    <span class="finance-label">–ù–∞–ª–æ–≥ –∫ —É–ø–ª–∞—Ç–µ:</span>
                    <span class="finance-value negative" id="periodTax">$0</span>
                </div>
                <div class="finance-item">
                    <span class="finance-label">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å:</span>
                    <span class="finance-value positive" id="periodNetProfit">$0</span>
                </div>
            </div>
            
            <h4 style="margin-top: 20px;">–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h4>
            <div id="productPortfolio"></div>
            
            <h4 style="margin-top: 20px;">–°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã</h4>
            <div id="securityStatus" class="tech-item">
                <div style="color: #0f0;">‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∞–∫—Ç–∏–≤–Ω–∞</div>
                <div id="cheatAttempts" style="font-size: 0.9rem; color: #8f8;">–ü–æ–ø—ã—Ç–æ–∫ —á–∏—Ç–µ—Ä—Å—Ç–≤–∞: 0</div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="productionModal" class="modal">
        <div class="modal-content screen">
            <div class="modal-header">
                <h3 id="modalTechName">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</h3>
                <button class="close-modal" id="closeProductionModal">&times;</button>
            </div>
            <div id="productionModalContent"></div>
        </div>
    </div>
    
    <div id="saveLoadModal" class="modal">
        <div class="modal-content screen">
            <div class="modal-header">
                <h3 id="modalTitle">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã</h3>
                <button class="close-modal" id="closeSaveLoadModal">&times;</button>
            </div>
            <div id="saveLoadContent"></div>
        </div>
    </div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notificationArea"></div>
    
    <!-- CAPTCHA –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="captchaModal" class="modal captcha-modal" style="display: none;">
        <div class="modal-content screen">
            <div class="modal-header">
                <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                <button class="close-modal" id="closeCaptchaModal">&times;</button>
            </div>
            <div id="captchaContent"></div>
        </div>
    </div>

<script>
// ==================== –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ====================

let gameState = {
    companyName: "",
    ceoName: "",
    country: "usa",
    balance: 0,
    xp: 0,
    year: 1980,
    month: 1,
    day: 1,
    quarter: 1,
    paused: false,
    reputation: {  // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
        quality: 50,    // 0-100
        price: 50,      // 0-100
        innovation: 50, // 0-100
        service: 50,    // 0-100
        reliability: 50 // 0-100
    },
    soundEnabled: true,
    researchedTechs: [],
    products: [],
    salesHistory: [],
    periodStats: {
        income: 0,
        expense: 0,
        profit: 0,
        tax: 0,
        netProfit: 0
    },
    marketingCampaigns: [],
    achievements: [],
    totalRevenue: 0,
    totalProducts: 0,
    gameStartTime: Date.now(),
    version: 2.0
};

// –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
const technologies = [
    { id: "rom", name: "ROM-–ø–∞–º—è—Ç—å", year: 1980, researchCost: 0, xpCost: 0, baseCost: 100, points: 30 },
    { id: "floppy5", name: '5.25" FDD', year: 1981, researchCost: 5000, xpCost: 100, baseCost: 150, points: 40 },
    { id: "hdd10", name: "HDD (10MB)", year: 1983, researchCost: 15000, xpCost: 300, baseCost: 500, points: 60 },
    { id: "cdrom", name: "CD-ROM", year: 1988, researchCost: 30000, xpCost: 800, baseCost: 800, points: 80 },
    { id: "dvd", name: "DVD", year: 1995, researchCost: 50000, xpCost: 1500, baseCost: 1000, points: 100 },
    { id: "usb", name: "USB Flash", year: 1998, researchCost: 100000, xpCost: 3000, baseCost: 1500, points: 120 },
    { id: "ssd40", name: "Early SSD (40GB)", year: 2000, researchCost: 100000, xpCost: 3000, baseCost: 2000, points: 150 },
    { id: "microsd", name: "Micro SD (64GB)", year: 2005, researchCost: 150000, xpCost: 5000, baseCost: 4000, points: 200},
    { id: "bluray", name: "Blu-Ray", year: 2006, researchCost: 20000, xpCost: 8000, baseCost: 4500, points: 220},
    { id: "nvme", name: "NVMe SSD (1TB)", year: 2010, researchCost: 250000, xpCost: 10000, baseCost: 5000, points: 250 },
    { id: "dna", name: "–î–ù–ö –•—Ä–∞–Ω–∏–ª–∏—â–µ", year: 2030, researchCost: 300000, xpCost: 100000, baseCost: 10000, points: 500}
];

const technologySpecs = {
    "rom": { optimalCapacity: 64, basePrice: 150, demand: 0.3 },
    "floppy5": { optimalCapacity: 360, basePrice: 200, demand: 0.5 },
    "hdd10": { optimalCapacity: 10000, basePrice: 500, demand: 0.8 },
    "cdrom": { optimalCapacity: 700, basePrice: 300, demand: 1.2 },
    "dvd": { optimalCapacity: 4700, basePrice: 400, demand: 1.5 },
    "usb": { optimalCapacity: 256, basePrice: 100, demand: 2.0 },
    "ssd40": { optimalCapacity: 40000, basePrice: 800, demand: 2.5 },
    "microsd": { optimalCapacity: 8192, basePrice: 150, demand: 2.8 },
    "bluray": { optimalCapacity: 25000, basePrice: 600, demand: 1.8 },
    "nvme": { optimalCapacity: 1048576, basePrice: 1500, demand: 3.0 },
    "dna": { optimalCapacity: 1000000, basePrice: 5000, demand: 0.1 }
};

const gameEvents = [
    { year: 1981, text: "IBM PC –≤—ã–ø—É—â–µ–Ω! –°–ø—Ä–æ—Å –Ω–∞ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–∏ —Ä–∞—Å—Ç—ë—Ç.", effect: { demand: 1.3 } },
    { year: 1984, text: "Apple Macintosh –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω. –ù–æ–≤—ã–π —Ä—ã–Ω–æ–∫ –æ—Ç–∫—Ä—ã—Ç!", effect: { demand: 1.2 } },
    { year: 1995, text: "Windows 95 –∑–∞–ø—É—â–µ–Ω–∞. –¢—Ä–µ–±—É—é—Ç—Å—è –±–æ–ª—å—à–∏–µ –¥–∏—Å–∫–∏!", effect: { demand: 1.5 } },
    { year: 2000, text: "–ü—Ä–æ–±–ª–µ–º–∞ Y2K. –°–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è!", effect: { demand: 1.4 } },
    { year: 2007, text: "iPhone –≤—ã–ø—É—â–µ–Ω. –¢—Ä–µ–±—É—é—Ç—Å—è –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–∏.", effect: { demand: 1.3 } },
    { year: 2010, text: "–û–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞—Å—Ç—É—Ç. –°–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –¥–∏—Å–∫–∏!", effect: { demand: 1.6 } }
];


// –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
const achievementsList = [
    { id: "first_product", name: "–ü–µ—Ä–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç", description: "–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å", reward: 100, xp: 50 },
    { id: "millionaire", name: "–ú–∏–ª–ª–∏–æ–Ω–µ—Ä", description: "–ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –º–∏–ª–ª–∏–æ–Ω –¥–æ–ª–ª–∞—Ä–æ–≤", reward: 1000, xp: 500 },
    { id: "tech_master", name: "–ú–∞—Å—Ç–µ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π", description: "–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –≤—Å–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", reward: 5000, xp: 2500 },
    { id: "year_2000", name: "–í—Å—Ç—Ä–µ—á–∞ –º–∏–ª–ª–µ–Ω–∏—É–º–∞", description: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 2000 –≥–æ–¥–∞", reward: 2000, xp: 1000 },
    { id: "product_10", name: "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å", description: "–°–æ–∑–¥–∞–π—Ç–µ 10 –ø—Ä–æ–¥—É–∫—Ç–æ–≤", reward: 500, xp: 250 },
    { id: "gaben", name: "–ò—Å—Ç–∏–Ω–Ω—ã–π –ì–∞–±–µ–Ω", description: "–ù–∞–∑–æ–≤–∞–∏—Ç–µ –ª—é–±–æ–π —Ç–∏–ø –ø–∞–º—è—Ç–∏ —à–æ–∫–æ–ª–∞–¥–∫–æ–π", reward: 1000, xp: 1000},
    { id: "year_2014", name: "–í—Å—Ç—Ä–µ—á–∞ —Å —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º", description: "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 2014 –≥–æ–¥–∞", reward: 15000, xp: 8000},
    { id: "belarus", name: "–ò—Å—Ç–∏–Ω–Ω—ã–π –±–µ–ª–∞—Ä—É—Å", description: "–ù–∞–∑–æ–≤–∞–∏—Ç–µ –ª—é–±–æ–π —Ç–∏–ø –ø–∞–º—è—Ç–∏ –∫–∞—Ä—Ç–æ—à–∫–æ–π"}
];

// –°—Ç—Ä–∞–Ω—ã
const countries = {
    usa: { name: "–°–®–ê", startCapital: 50000, taxRate: 0.25 },
    japan: { name: "–Ø–ø–æ–Ω–∏—è", startCapital: 45000, taxRate: 0.20 },
    ussr: { name: "–°–°–°–†", startCapital: 30000, taxRate: 0.15 },
    germany: { name: "–ì–µ—Ä–º–∞–Ω–∏—è", startCapital: 60000, taxRate: 0.30 },
    china: { name: "–ö–∏—Ç–∞–π", startCapital: 35000, taxRate: 0.20 },
    northKorea: { name: "–°–µ–≤–µ—Ä–Ω–∞—è –ö–æ—Ä–µ—è", startCapital: 20000, taxRate: 0.10 },
    southKorea: { name: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è", startCapital: 25000, taxRate: 0.15 },
    belarus: { name: "–ë–µ–ª–∞—Ä—É—Å—å", startCapital: 15000, taxRate: 0.05 }
};

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const elements = {
    startScreen: document.querySelector('.start-screen'),
    gameContainer: document.querySelector('.game-container'),
    companyName: document.getElementById('companyName'),
    ceoName: document.getElementById('ceoName'),
    countrySelect: document.getElementById('country'),
    startGameBtn: document.getElementById('startGame'),
    currentCompanyName: document.getElementById('currentCompanyName'),
    currentCeoName: document.getElementById('currentCeoName'),
    currentDate: document.getElementById('currentDate'),
    currentBalance: document.getElementById('currentBalance'),
    currentXP: document.getElementById('currentXP'),
    currentQuarter: document.getElementById('currentQuarter'),
    pauseBtn: document.getElementById('pauseBtn'),
    saveGameBtn: document.getElementById('saveGameBtn'),
    loadGameBtn: document.getElementById('loadGameBtn'),
    soundToggle: document.getElementById('soundToggle'),
    techList: document.getElementById('techList'),
    storeProducts: document.getElementById('storeProducts'),
    marketingCampaigns: document.getElementById('marketingCampaigns'),
    productionInterface: document.getElementById('productionInterface'),
    achievementsList: document.getElementById('achievementsList'),
    periodIncome: document.getElementById('periodIncome'),
    periodExpense: document.getElementById('periodExpense'),
    periodProfit: document.getElementById('periodProfit'),
    periodTax: document.getElementById('periodTax'),
    periodNetProfit: document.getElementById('periodNetProfit'),
    productPortfolio: document.getElementById('productPortfolio'),
    notificationArea: document.getElementById('notificationArea'),
    salesChart: document.getElementById('salesChart'),
    tabs: document.querySelectorAll('.tab'),
    tabContents: document.querySelectorAll('.tab-content'),
    productionModal: document.getElementById('productionModal'),
    saveLoadModal: document.getElementById('saveLoadModal'),
    captchaModal: document.getElementById('captchaModal'),
    aboutModal: document.getElementById('about'),
    resetGame: document.getElementById('resetGameBtn'),
    marketTab: document.getElementById('marketTab'),
    currentCountry: document.getElementById('currentCountry')
};

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
let gameInterval = null;
let salesChartInstance = null;
let currentTech = null;

// ==================== –°–ò–°–¢–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò ====================

class GameSecuritySystem {
    constructor() {
        this.cheatAttempts = 0;
        this.penalties = {};
        this.lastBalance = gameState.balance;
        this.lastXP = gameState.xp;
        this.initialized = false;
        this.setupSecurity();
    }
    
    setupSecurity() {
        // 1. –ó–∞—â–∏—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        this.protectGameState();
        
        // 2. –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DevTools
        this.setupDevToolsDetection();
        
        // 3. –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        this.setupTimeProtection();
        
        // 4. –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
        this.setupMemoryProtection();
        
        // 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–Ω–æ–º–∞–ª–∏–π
        this.setupAnomalyDetection();
        
        this.initialized = true;
        console.log('üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
    }
    
    protectGameState() {
        const protectedProperties = ['balance', 'xp', 'researchedTechs', 'products'];
        
        protectedProperties.forEach(prop => {
            let originalValue = gameState[prop];
            const descriptor = Object.getOwnPropertyDescriptor(gameState, prop);
            
            if (!descriptor) {
                Object.defineProperty(gameState, prop, {
                    get: () => originalValue,
                    set: (value) => {
                        if (prop === 'balance') {
                            if (Math.abs(value - this.lastBalance) > 100000) {
                                this.recordCheat('suspicious_balance_change', 
                                    `${this.lastBalance} -> ${value}`);
                                return;
                            }
                            this.lastBalance = value;
                        }
                        
                        if (prop === 'xp') {
                            if (value < this.lastXP) {
                                this.recordCheat('xp_decrease', 
                                    `${this.lastXP} -> ${value}`);
                                return;
                            }
                            this.lastXP = value;
                        }
                        
                        originalValue = value;
                    },
                    configurable: false,
                    enumerable: true
                });
            }
        });
    }
    
    setupDevToolsDetection() {        
        // –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        setInterval(() => {
            const start = performance.now();
            //debugger;
            const end = performance.now();
            if (end - start > 100) {
                this.recordCheat('debugger_detected', '–û–±–Ω–∞—Ä—É–∂–µ–Ω –æ—Ç–ª–∞–¥—á–∏–∫');
            }
        }, 30000);
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            const blocked = [
                e.key === 'F12',
                e.ctrlKey && e.shiftKey && e.key === 'I',
                e.ctrlKey && e.shiftKey && e.key === 'J',
                e.ctrlKey && e.shiftKey && e.key === 'C'
            ];
            
            if (blocked.some(b => b)) {
                e.preventDefault();
                this.recordCheat('devtools_shortcut', '–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å DevTools');
                showNotification("–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã", "error");
            }
        });
    }
    
    setupTimeProtection() {

    }
    
    calculateGameDays() {
        return gameState.year * 365 + (gameState.month - 1) * 30 + gameState.day;
    }
    
    setupMemoryProtection() {
        // –ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        Object.freeze(technologies);
        Object.freeze(countries);
        Object.freeze(achievementsList);
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
        setInterval(() => this.checkIntegrity(), 60000);
    }
    
    setupAnomalyDetection() {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–æ—Ç–æ–≤
        this.setupBotDetection();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é –∫–æ–¥–∞
        this.setupCodeIntegrity();
    }
    
    setupBotDetection() {
        const clickTimes = [];
        let lastClickTime = 0;
        
        document.addEventListener('click', (e) => {
            const now = Date.now();
            
            // –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏
            if (now - lastClickTime < 50) {
                clickTimes.push(now);
                
                if (clickTimes.length > 20) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å
                    const intervals = [];
                    for (let i = 1; i < clickTimes.length; i++) {
                        intervals.push(clickTimes[i] - clickTimes[i-1]);
                    }
                    
                    const avg = intervals.reduce((a, b) => a + b) / intervals.length;
                    const variance = intervals.reduce((a, b) => a + Math.pow(b - avg, 2), 0) / intervals.length;
                    
                    if (variance < 10) { // –û—á–µ–Ω—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∫–ª–∏–∫–∏
                        this.recordCheat('bot_detected', '–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –±–æ—Ç-–∫–ª–∏–∫–∏');
                    }
                    
                    clickTimes.length = 0;
                }
            }
            
            lastClickTime = now;
        });
    }
    
    setupCodeIntegrity() {
        // –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
        const criticalFunctions = {
            processSales: processSales.toString(),
            updateGameUI: updateGameUI.toString(),
            gameTick: gameTick.toString()
        };
        
        const originalHashes = {};
        Object.keys(criticalFunctions).forEach(key => {
            originalHashes[key] = this.hashString(criticalFunctions[key]);
        });
        
        setInterval(() => {
            Object.keys(criticalFunctions).forEach(key => {
                const currentHash = this.hashString(criticalFunctions[key]);
                if (currentHash !== originalHashes[key]) {
                    this.recordCheat('code_tampering', `–§—É–Ω–∫—Ü–∏—è ${key} –∏–∑–º–µ–Ω–µ–Ω–∞`);
                }
            });
        }, 3000);
    }
    
    hashString(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return hash.toString(36);
    }
    
    checkIntegrity() {
        const checks = [
            gameState.balance >= 0,
            gameState.xp >= 0,
            gameState.year >= 1980,
            gameState.month >= 1 && gameState.month <= 12,
            gameState.day >= 1 && gameState.day <= 31,
            gameState.researchedTechs.every(techId => 
                technologies.some(t => t.id === techId)),
            gameState.products.every(product => 
                product.cost > 0 && product.price >= product.cost)
        ];
        
        if (!checks.every(check => check)) {
            this.recordCheat('integrity_violation', '–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏–≥—Ä—ã');
            this.repairGameState();
        }
    }
    
    repairGameState() {
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        gameState.balance = Math.max(0, gameState.balance);
        gameState.xp = Math.max(0, gameState.xp);
        gameState.year = Math.max(1980, Math.min(gameState.year, 2100));
        gameState.month = Math.max(1, Math.min(gameState.month, 12));
        gameState.day = Math.max(1, Math.min(gameState.day, 31));
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        gameState.products = gameState.products.filter(product => 
            product && product.cost > 0 && product.price >= product.cost);
        
        showNotification('–ü—Ä–æ–≤–µ–¥–µ–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', 'error');
    }
    
    recordCheat(type, details) {
        this.cheatAttempts++;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const cheatCounter = document.getElementById('cheatAttempts');
        if (cheatCounter) {
            cheatCounter.textContent = `–ü–æ–ø—ã—Ç–æ–∫ —á–∏—Ç–µ—Ä—Å—Ç–≤–∞: ${this.cheatAttempts}`;
        }
        
        console.warn(`[–ê–ù–¢–ò–ß–ò–¢] ${type}: ${details} (${this.cheatAttempts})`);
        
        // –õ–æ–≥–∏—Ä—É–µ–º
        if (!this.penalties[type]) this.penalties[type] = 0;
        this.penalties[type]++;
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–∫–∞–∑–∞–Ω–∏–µ
        this.applyPenalty(type);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç
        this.sendCheatReport(type, details);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º CAPTCHA –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (this.cheatAttempts >= 3) {
            this.showCaptcha();
        }
    }
    
    applyPenalty(type) {
        const count = this.penalties[type];
        
        switch(count) {
            case 1:
                this.applyWarning();
                break;
            case 2:
                this.applySlowPenalty();
                break;
            case 3:
                this.applyRevenuePenalty();
                break;
            case 8:
                this.applyFatalPenalty();
                break;
            default:
                this.applyHardPenalty();
                break;
        }
    }
    
    applyWarning() {
        showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –ò–≥—Ä–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ!', 'error');
    }
    
    applySlowPenalty() {
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É
        const originalGameTick = gameTick;
        window.gameTick = function() {
            setTimeout(originalGameTick, 100);
        };
        
        showNotification('–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∞.', 'error');
        
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É
        setTimeout(() => {
            window.gameTick = originalGameTick;
        }, 60000);
    }
    
    applyRevenuePenalty() {
        const penaltyMultiplier = 0.5;
        const originalProcessSales = processSales;
        
        window.processSales = function() {
            // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤
            const originalMultiplier = 1;
            const tempMultiplier = penaltyMultiplier;
            
            const result = originalProcessSales();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã
            setTimeout(() => {
                window.processSales = originalProcessSales;
            }, 120000);
            
            return result;
        };
        
        showNotification('–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª. –î–æ—Ö–æ–¥—ã —Å–Ω–∏–∂–µ–Ω—ã –Ω–∞ 50% –Ω–∞ 2 –º–∏–Ω—É—Ç—ã.', 'error');
    }
    
    applyTimePenalty() {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–¥–µ–ª—é –≤–ø–µ—Ä–µ–¥ –∫–∞–∫ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ
        gameState.day += 7;
        const daysInMonth = getDaysInMonth(gameState.month, gameState.year);
        
        if (gameState.day > daysInMonth) {
            gameState.day -= daysInMonth;
            gameState.month++;
            
            if (gameState.month > 12) {
                gameState.month = 1;
                gameState.year++;
            }
        }
        
        showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏. –ò–≥—Ä–∞ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞ –Ω–∞ 7 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥.', 'error');
    }
    
    applyHardPenalty() {
        // –°–µ—Ä—å–µ–∑–Ω–æ–µ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ - –ø–æ—Ç–µ—Ä—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        gameState.balance = Math.max(1000, gameState.balance * 0.5);
        gameState.xp = Math.max(0, gameState.xp * 0.5);
        
        showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —á–∏—Ç–µ—Ä—Å—Ç–≤–æ. –ë–∞–ª–∞–Ω—Å –∏ –æ–ø—ã—Ç —É–º–µ–Ω—å—à–µ–Ω—ã –≤–¥–≤–æ–µ.', 'error');
    }

    applyFatalPenalty() {
        gameState.balance = 0;
        gameState.xp = 0;
        
        showNotification('–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —á–∏—Ç–µ—Ä—Å—Ç–≤–æ. –ë–∞–ª–∞–Ω—Å –∏ –æ–ø—ã—Ç —Å–±—Ä–æ—à–µ–Ω.', 'error');
    }
    
    sendCheatReport(type, details) {
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ (–µ—Å–ª–∏ –Ω–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª)
        if (window.location.protocol !== 'file:') {
            const report = {
                type: type,
                details: details,
                timestamp: Date.now(),
                cheatAttempts: this.cheatAttempts,
                gameState: {
                    balance: gameState.balance,
                    xp: gameState.xp,
                    year: gameState.year
                }
            };
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º sendBeacon –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                const blob = new Blob([JSON.stringify(report)], { type: 'application/json' });
                navigator.sendBeacon('/api/cheat-report', blob);
            } catch (e) {
                console.log('–û—Ç—á–µ—Ç –æ —á–∏—Ç–µ—Ä—Å—Ç–≤–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)');
            }
        }
    }
    
    showCaptcha() {
        const captchaCode = Math.floor(1000 + Math.random() * 9000);
        sessionStorage.setItem('captchaCode', captchaCode.toString());
        
        elements.captchaModal.style.display = 'flex';
        elements.captchaModal.innerHTML = `
            <div class="modal-content screen">
                <div class="modal-header">
                    <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</h3>
                    <button class="close-modal" id="closeCaptchaBtn">&times;</button>
                </div>
                <div style="padding: 20px;">
                    <p style="color: #8f8; margin-bottom: 20px;">
                        –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤—ã –Ω–µ —Ä–æ–±–æ—Ç.
                    </p>
                    <div class="captcha-code">${captchaCode}</div>
                    <input type="text" id="captchaInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤—ã—à–µ" 
                           style="width: 100%; padding: 10px; margin: 20px 0; background: #002200; border: 1px solid #0a0; color: #0f0;">
                    <button id="submitCaptcha" style="width: 100%; padding: 10px; background: #004400; color: #0f0; border: 1px solid #0a0;">
                        –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                    </button>
                </div>
            </div>
        `;
        
        document.getElementById('closeCaptchaBtn').addEventListener('click', () => {
            elements.captchaModal.style.display = 'none';
        });
        
        document.getElementById('submitCaptcha').addEventListener('click', () => {
            const input = document.getElementById('captchaInput').value;
            const savedCode = sessionStorage.getItem('captchaCode');
            
            if (input === savedCode) {
                elements.captchaModal.style.display = 'none';
                sessionStorage.removeItem('captchaCode');
                showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                this.cheatAttempts = Math.max(0, this.cheatAttempts - 1);
            } else {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥', 'error');
                this.recordCheat('captcha_failed', '–ù–µ–≤–µ—Ä–Ω—ã–π CAPTCHA');
            }
        });
    }
}

// ==================== –®–ò–§–†–û–í–ê–ù–ò–ï –°–û–•–†–ê–ù–ï–ù–ò–ô ====================

class SaveEncryption {
    static encrypt(data) {
        const json = JSON.stringify(data);
        let encrypted = '';
        
        // –ü—Ä–æ—Å—Ç–æ–µ XOR —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
        for (let i = 0; i < json.length; i++) {
            const charCode = json.charCodeAt(i);
            encrypted += String.fromCharCode(charCode ^ 0x55);
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É
        const checksum = this.calculateChecksum(data);
        
        // –ö–æ–¥–∏—Ä—É–µ–º –≤ base64 –ø—Ä–∞–≤–∏–ª—å–Ω–æ
        const toEncode = encrypted + '|' + checksum;
        return btoa(unescape(encodeURIComponent(toEncode)));
    }
    
    static decrypt(encryptedData) {
        try {
            // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∏–∑ base64
            const decoded = decodeURIComponent(escape(atob(encryptedData)));
            const [encrypted, checksum] = decoded.split('|');
            
            let decrypted = '';
            for (let i = 0; i < encrypted.length; i++) {
                const charCode = encrypted.charCodeAt(i);
                decrypted += String.fromCharCode(charCode ^ 0x55);
            }
            
            const data = JSON.parse(decrypted);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É
            if (this.calculateChecksum(data) !== checksum) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞');
            }
            
            return data;
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏:', error);
            throw new Error('–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
        }
    }
    
    static calculateChecksum(data) {
        const str = JSON.stringify({
            balance: data.balance,
            xp: data.xp,
            year: data.year,
            version: data.version
        });
        
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return Math.abs(hash).toString(36);
    }
}

function debugTechStatus() {
    console.log('=== –î–ï–ë–ê–ì –¢–ï–•–ù–û–õ–û–ì–ò–ô ===');
    console.log('–¢–µ–∫—É—â–∏–π –≥–æ–¥:', gameState.year);
    console.log('–ë–∞–ª–∞–Ω—Å:', gameState.balance);
    console.log('XP:', gameState.xp);
    console.log('–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:', gameState.researchedTechs);
    
    technologies.forEach(tech => {
        const isResearched = gameState.researchedTechs.includes(tech.id);
        const isAvailable = tech.year <= gameState.year;
        const canResearch = isAvailable && !isResearched && 
                          gameState.balance >= tech.researchCost && 
                          gameState.xp >= tech.xpCost;
        
        console.log(`${tech.name} (${tech.year}):`, {
            available: isAvailable ? '‚úÖ' : '‚ùå',
            researched: isResearched ? '‚úÖ' : '‚ùå',
            canResearch: canResearch ? '‚úÖ' : '‚ùå',
            reason: !isAvailable ? '–ï—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª –≥–æ–¥' : 
                    isResearched ? '–£–∂–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞' :
                    gameState.balance < tech.researchCost ? '–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥' :
                    gameState.xp < tech.xpCost ? '–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç XP' :
                    '–ú–æ–∂–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å'
        });
    });
}

function newGame() {

}

// ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ====================

function initGame() {
    populateCountrySelect();
    updateCountryInfo();
    assignEventListeners();
    initSalesChart();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    window.gameSecurity = new GameSecuritySystem();
}

function populateCountrySelect() {
    const countrySelect = document.getElementById('country');
    countrySelect.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º –æ–ø—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω—ã
    for (const [key, country] of Object.entries(countries)) {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = country.name;
        countrySelect.appendChild(option);
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –°–®–ê –∫–∞–∫ —Å—Ç—Ä–∞–Ω—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    countrySelect.value = 'usa';
}

function updateCountryInfo() {
    const country = elements.countrySelect.value;
    const countryData = countries[country];
    document.getElementById('countryDetails').textContent = 
        `${countryData.name}: –ù–∞—á–∞–ª—å–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª $${countryData.startCapital.toLocaleString()}, –Ω–∞–ª–æ–≥ ${countryData.taxRate*100}%`;
}

function assignEventListeners() {
    elements.countrySelect.addEventListener('change', updateCountryInfo);
    elements.startGameBtn.addEventListener('click', startGame);
    elements.pauseBtn.addEventListener('click', togglePause);
    elements.saveGameBtn.addEventListener('click', showSaveModal);
    elements.loadGameBtn.addEventListener('click', showLoadModal);
    //elements.soundToggle.addEventListener('click', toggleSound);

    elements.aboutModal.addEventListener('click', about);
    
    elements.tabs.forEach(tab => {
        tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });
    
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space') togglePause();
        if (e.ctrlKey && e.code === 'KeyS') { e.preventDefault(); showSaveModal(); }
        if (e.ctrlKey && e.code === 'KeyL') { e.preventDefault(); showLoadModal(); }
        if (e.code === 'Escape') closeAllModals();
    });
}

function startGame() {
    const companyName = elements.companyName.value.trim();
    const ceoName = elements.ceoName.value.trim();
    
    if (!companyName || !ceoName) {
        showNotification("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –∏–º—è CEO", "error");
        return;
    }
    
    const country = elements.countrySelect.value;
    const countryData = countries[country];
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
    gameState = {
        companyName: companyName,
        ceoName: ceoName,
        country: country,
        balance: countryData.startCapital,
        xp: 0,
        year: 1980,
        month: 1,
        day: 1,
        quarter: 1,
        paused: false,
        soundEnabled: true,
        researchedTechs: ["rom"],
        products: [],
        salesHistory: [],
        periodStats: { income: 0, expense: 0, profit: 0, tax: 0, netProfit: 0 },
        marketingCampaigns: [],
        achievements: [],
        totalRevenue: 0,
        totalProducts: 0,
        gameStartTime: Date.now(),
        version: 2.0
    };
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
    elements.startScreen.style.display = 'none';
    elements.gameContainer.style.display = 'grid';
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    updateGameUI();
    initTechTree();
    
    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    startGameLoop();
    
    showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ${companyName}, ${ceoName}!`, "success");
}

function updateReputation(product, profit) {
    // –ó–∞—â–∏—Ç–∞ –æ—Ç undefined
    if (!product || !product.techId || !gameState.reputation) {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ—Å–ª–∏ –Ω–µ—Ç
        if (!gameState.reputation) {
            gameState.reputation = {
                quality: 50,
                price: 50,
                innovation: 50,
                service: 50,
                reliability: 50
            };
        }
        return;
    }
    
    try {
        // –ù–∞—Ö–æ–¥–∏–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é
        const tech = technologies.find(t => t.id === product.techId);
        if (!tech) return;
        
        // –†–µ–ø—É—Ç–∞—Ü–∏—è —Ä–∞—Å—Ç–µ—Ç –ø—Ä–∏ —Ö–æ—Ä–æ—à–∏—Ö –ø—Ä–æ–¥–∞–∂–∞—Ö
        const profitMargin = profit / (product.sales * product.cost || 1);
        
        // –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏—é –∫–∞—á–µ—Å—Ç–≤–∞
        if (product.reliability > 70) {
            gameState.reputation.reliability += 1;
        }
        
        // –•–æ—Ä–æ—à–∞—è –ø—Ä–∏–±—ã–ª—å —É–ª—É—á—à–∞–µ—Ç —Ü–µ–Ω–æ–≤—É—é —Ä–µ–ø—É—Ç–∞—Ü–∏—é
        if (profitMargin > 0.2) {
            gameState.reputation.price += 1;
            gameState.reputation.quality += 1;
        }
        
        // –ù–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ–≤—ã—à–∞—é—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å
        if (gameState.year - tech.year <= 3) {
            gameState.reputation.innovation += 2;
        }
        
        // –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç –µ—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ–ª–≥–æ
        if (product.age > 180 && product.reliability > 60) {
            gameState.reputation.reliability += 1;
        }
        
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è 0-100
        Object.keys(gameState.reputation).forEach(key => {
            gameState.reputation[key] = Math.max(0, Math.min(100, gameState.reputation[key]));
        });
        
    } catch (error) {
        console.warn("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–ø—É—Ç–∞—Ü–∏–∏:", error);
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Ä–µ–ø—É—Ç–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if (!gameState.reputation) {
            gameState.reputation = {
                quality: 50,
                price: 50,
                innovation: 50,
                service: 50,
                reliability: 50
            };
        }
    }
}

function startGameLoop() {
    if (gameInterval) clearInterval(gameInterval);
    
    gameInterval = setInterval(() => {
        if (!gameState.paused) {
            gameTick();
        }
    }, 1000);
}

function checkEvents() {
    if (gameState.day === 1) {
        const event = gameEvents.find(e => e.year === gameState.year);
        if (event && !event.triggered) {
            showNotification(event.text, "info");
            event.triggered = true;
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã —Å–æ–±—ã—Ç–∏—è
            // –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ø—Ä–æ—Å


        }
    }
}

function gameTick() {
    if (!gameState.reputation) {
        gameState.reputation = {
            quality: 50,
            price: 50,
            innovation: 50,
            service: 50,
            reliability: 50
        };
    }

    gameState.day++;
    
    const daysInMonth = getDaysInMonth(gameState.month, gameState.year);
    if (gameState.day > daysInMonth) {
        gameState.day = 1;
        gameState.month++;
        
        if (gameState.month > 12) {
            gameState.month = 1;
            gameState.year++;
        }
        
        if (gameState.month % 3 === 1) {
            gameState.quarter = Math.ceil(gameState.month / 3);
        }
    }

    try {
        gameState.products.forEach(product => {
            product.age ++;

            if (product.age >= 366) {
                const index = gameState.products.indexOf(product);
                if (index !== -1) {
                    gameState.products.splice(index, 1);
                }
            }
        });
    } catch {

    };


    checkAvailableTechnologies();

    checkAchievements();

    checkMarketSaturation();

    checkEvents();
    
    processSales();
    updateGameUI();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
    updateMarketingCampaigns();
    
    if (gameState.day === 1) {
        processTaxes();
        updateSalesChart();
    }
}

function getTechYear(techId) {
    return technologies.find(t => t.id === techId)?.year || 0;
}

function checkMarketSaturation() {
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º
    const techGroups = {};
    gameState.products.forEach(product => {
        if (!techGroups[product.techId]) techGroups[product.techId] = [];
        techGroups[product.techId].push(product);
    });
    
    // –î–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π —Å –±–æ–ª–µ–µ —á–µ–º 3 –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ —Å–Ω–∏–∂–∞–µ–º –ø—Ä–æ–¥–∞–∂–∏
    Object.keys(techGroups).forEach(techId => {
        if (techGroups[techId].length > 3) {
            const saturation = techGroups[techId].length - 3;
            const penalty = Math.min(0.5, saturation * 0.1); // –ú–∞–∫—Å 50% —Å–Ω–∏–∂–µ–Ω–∏–µ
            
            techGroups[techId].forEach(product => {
                if (!product.saturationPenalty) product.saturationPenalty = 0;
                product.saturationPenalty = penalty;
            });
            
            if (saturation > 0 && gameState.day % 30 === 0) {
                showNotification(
                    `–†—ã–Ω–æ–∫ ${technologies.find(t => t.id === techId)?.name} –ø–µ—Ä–µ–Ω–∞—Å—ã—â–µ–Ω! –ü—Ä–æ–¥–∞–∂–∏ —Å–Ω–∏–∂–µ–Ω—ã.`,
                    "warning"
                );
            }
        } else {
            techGroups[techId]?.forEach(product => {
                product.saturationPenalty = 0;
            });
        }
    });
}

function debugProduction(techId) {
    const tech = technologies.find(t => t.id === techId);
    if (!tech) {
        console.error('‚ùå –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', techId);
        return;
    }
    
    console.log('=== –û–¢–õ–ê–î–ö–ê –ü–†–û–ò–ó–í–û–î–°–¢–í–ê ===');
    console.log('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:', tech.name);
    console.log('–ë–∞–ª–∞–Ω—Å –∏–≥—Ä—ã:', gameState.balance);
    console.log('–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞ –ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è:', gameState.researchedTechs.includes(techId));
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–∞–π–¥–µ—Ä—ã
    const capacitySlider = document.getElementById('capacitySlider');
    const speedSlider = document.getElementById('speedSlider');
    const reliabilitySlider = document.getElementById('reliabilitySlider');
    
    console.log('–°–ª–∞–π–¥–µ—Ä—ã –Ω–∞–π–¥–µ–Ω—ã:', {
        capacity: !!capacitySlider,
        speed: !!speedSlider,
        reliability: !!reliabilitySlider
    });
    
    if (capacitySlider && speedSlider && reliabilitySlider) {
        const capacity = parseInt(capacitySlider.value) || 50;
        const speed = parseInt(speedSlider.value) || 50;
        const reliability = parseInt(reliabilitySlider.value) || 50;
        
        console.log('–ó–Ω–∞—á–µ–Ω–∏—è —Å–ª–∞–π–¥–µ—Ä–æ–≤:', { capacity, speed, reliability });
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
        const cost = Math.round(tech.baseCost * (capacity + speed + reliability) / 50);
        const productionCost = cost * 100;
        
        console.log('–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞:', cost);
        console.log('–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (x100):', productionCost);
        console.log('–ë–∞–ª–∞–Ω—Å —Ö–≤–∞—Ç–∞–µ—Ç?', gameState.balance >= productionCost);
        
        if (gameState.balance < productionCost) {
            const needed = productionCost - gameState.balance;
            console.log(`‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: $${needed}`);
        }
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ —Å –æ—Ç–ª–∞–¥–∫–æ–π
    const needed = productionCost - gameState.balance;

    showDebugModal(tech, productionCost, needed);
}

function showDebugModal(tech, productionCost, needed) {
    const debugModal = document.createElement('div');
    debugModal.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #001100;
        border: 2px solid #ff0;
        padding: 20px;
        border-radius: 10px;
        z-index: 99999;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        color: #0f0;
        font-family: monospace;
    `;
    
    debugModal.innerHTML = `
        <div style="margin-bottom: 15px;">
            <h3 style="color: #ff0; border-bottom: 1px solid #ff0; padding-bottom: 5px;">
                üêõ –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞: ${tech.name}
            </h3>
        </div>
        
        <div style="background: #002200; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span>–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
                <span style="color: ${gameState.balance >= productionCost ? '#0f0' : '#f00'}">
                    $${gameState.balance}
                </span>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span>–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞:</span>
                <span style="color: #ff0">${productionCost}</span>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span>–†–∞–∑–Ω–∏—Ü–∞:</span>
                <span style="color: ${gameState.balance >= productionCost ? '#0f0' : '#f00'}">
                    ${gameState.balance >= productionCost ? '‚úì –•–≤–∞—Ç–∞–µ—Ç' : `‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç $${needed}`}
                </span>
            </div>
        </div>
        
        <div style="background: #002200; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
            <h4 style="color: #8f8; margin-bottom: 10px;">–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏:</h4>
            <div style="margin-bottom: 5px;">–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: $${tech.baseCost}</div>
            <div style="margin-bottom: 5px;">–°—É–º–º–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: ${getSlidersSum()}</div>
            <div style="margin-bottom: 5px;">–§–æ—Ä–º—É–ª–∞: ${tech.baseCost} √ó (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏) √∑ 50</div>
            <div style="margin-bottom: 5px;">–ò—Ç–æ–≥: $${calculateProductionCost(tech)}</div>
            <div style="margin-bottom: 5px;">√ó 100 (—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞): <strong>$${productionCost}</strong></div>
        </div>
        
        <div style="margin-bottom: 15px;">
            <button onclick="fixProductionIssue('${tech.id}')" 
                    style="background: #006600; color: #0f0; border: none; padding: 10px 20px; 
                           border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 10px;">
                üí∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
            </button>
            
            <button onclick="reduceProductionCost('${tech.id}')" 
                    style="background: #004400; color: #8f8; border: none; padding: 10px 20px; 
                           border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 10px;">
                üìâ –£–º–µ–Ω—å—à–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
            </button>
            
            <button onclick="bypassProductionCost('${tech.id}')" 
                    style="background: #003300; color: #0f0; border: none; padding: 10px 20px; 
                           border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 10px;">
                ‚ö° –û–±–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            </button>
        </div>
        
        <div style="text-align: center;">
            <button onclick="this.parentElement.parentElement.remove()" 
                    style="background: #660000; color: #fff; border: none; padding: 10px 20px; 
                           border-radius: 5px; cursor: pointer;">
                –ó–∞–∫—Ä—ã—Ç—å
            </button>
        </div>
    `;
    
    document.body.appendChild(debugModal);
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
function getSlidersSum() {
    const capacity = parseInt(document.getElementById('capacitySlider')?.value) || 50;
    const speed = parseInt(document.getElementById('speedSlider')?.value) || 50;
    const reliability = parseInt(document.getElementById('reliabilitySlider')?.value) || 50;
    return capacity + speed + reliability;
}

function calculateProductionCost(tech) {
    const sum = getSlidersSum();
    return Math.round(tech.baseCost * sum / 50);
}

function checkAvailableTechnologies() {
    let newTechsAvailable = false;
    
    technologies.forEach(tech => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –ø–æ –≥–æ–¥—É
        if (tech.year <= gameState.year) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞ –ª–∏ —É–∂–µ
            if (!gameState.researchedTechs.includes(tech.id)) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
                const canResearchNow = gameState.balance >= tech.researchCost && 
                                     gameState.xp >= tech.xpCost;
                
                if (canResearchNow) {
                    // –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è!
                    newTechsAvailable = true;
                    
                    // –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
                    if (gameState.day % 7 === 0) {
                        showNotification(`–î–æ—Å—Ç—É–ø–Ω–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è: ${tech.name}. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ: $${tech.researchCost} + ${tech.xpCost} XP`, "info");
                    }
                }
            }
        }
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ä–µ–≤–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ
    if (newTechsAvailable) {
        initTechTree();
    }
}

function round(value, decimals = 0) {
    if (decimals === 0) {
        return Math.sign(value) * Math.round(Math.abs(value));
    }
    
    const factor = Math.pow(10, decimals);
    return Math.sign(value) * Math.round(Math.abs(value) * factor) / factor;
}

function processSales() {
    const validProducts = gameState.products.filter(product => 
        product && product.onSale && product.techId && product.cost > 0
    );
    
    validProducts.forEach(product => {
        if (!product.onSale) return;
        
        // === –û–°–ù–û–í–ù–´–ï –§–ê–ö–¢–û–†–´ ===
        
        // 1. –¶–ï–ù–û–í–ê–Ø –≠–õ–ê–°–¢–ò–ß–ù–û–°–¢–¨ (—Å–∏–ª—å–Ω–µ–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∂–∏)
        const optimalPrice = product.cost * getOptimalPriceMultiplier(product.techId);
        const priceDeviation = Math.abs(product.price - optimalPrice) / optimalPrice;
        const priceFactor = Math.max(0.1, 1 - priceDeviation * 3); // –£–≤–µ–ª–∏—á–∏–ª–∏ –≤–ª–∏—è–Ω–∏–µ
        
        // 2. –ö–ê–ß–ï–°–¢–í–û –ü–†–û–î–£–ö–¢–ê (—Å–∏–ª—å–Ω–µ–µ –≤–ª–∏—è–µ—Ç)
        const qualityScore = calculateQualityScore(product);
        const qualityFactor = 0.3 + qualityScore * 0.7; // –ö–∞—á–µ—Å—Ç–≤–æ –≤–∞–∂–Ω–µ–µ
        
        // 3. –¢–ï–•–ù–û–õ–û–ì–ò–ß–ï–°–ö–û–ï –ü–†–ï–ò–ú–£–©–ï–°–¢–í–û
        const techAge = gameState.year - getTechYear(product.techId);
        const techFactor = techAge <= 2 ? 1.8 : 
                         techAge <= 5 ? 1.3 : 
                         techAge <= 10 ? 0.8 : 0.4;
        
        // 4. –í–û–ó–†–ê–°–¢ –ü–†–û–î–£–ö–¢–ê (—Å–∏–ª—å–Ω–µ–µ –≤–ª–∏—è–µ—Ç)
        const ageFactor = Math.max(0.1, 1 - (product.age / 365) * 0.8);
        
        // 5. –ö–û–ù–ö–£–†–ï–ù–¶–ò–Ø (–Ω–æ–≤–æ–µ!)
        const similarProducts = gameState.products.filter(p => 
            p.techId === product.techId && p.id !== product.id
        ).length;
        const competitionFactor = Math.max(0.2, 1 - (similarProducts * 0.15));
        
        // 6. –†–ï–ü–£–¢–ê–¶–ò–Ø –ö–û–ú–ü–ê–ù–ò–ò
        const reputationFactor = gameState.reputation && gameState.reputation.quality ? 
            0.5 + (gameState.reputation.quality / 100) * 0.5 : 0.5;
        
        // === –†–ê–°–ß–ï–¢ –ü–†–û–î–ê–ñ ===
        const baseSales = getBaseSales(product.techId);
        const rawSales = baseSales * 
                        priceFactor * 
                        qualityFactor * 
                        techFactor * 
                        ageFactor * 
                        competitionFactor * 
                        reputationFactor * 
                        (0.9 + Math.random() * 0.2);
        
        const sales = Math.max(0, Math.round(rawSales));
        
        // === –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ï –†–ê–°–ß–ï–¢–´ ===
        if (sales > 0) {
            const revenue = Math.round(sales * product.price);
            const profit = Math.round(sales * (product.price - product.cost));
            
            product.sales += sales;
            product.totalSales += sales;
            product.revenue += revenue;
            
            gameState.balance += profit;
            gameState.periodStats.income += revenue;
            gameState.periodStats.profit += profit;
            gameState.totalRevenue += revenue;
            
            // –û–ø—ã—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞
            const xpMultiplier = 1 + (qualityScore > 0.8 ? 0.5 : 0) + (techFactor > 1.5 ? 0.3 : 0);
            gameState.xp += Math.floor(profit * 0.1 * xpMultiplier + sales * 2);
        }
    });
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
function calculateQualityScore(product) {
    const tech = technologies.find(t => t.id === product.techId);
    if (!tech) return 0.5;
    
    // –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
    const optimalCapacities = {
        "rom": 64, "floppy5": 360, "hdd10": 10000, "cdrom": 700,
        "dvd": 4700, "usb": 256, "ssd40": 40000, "microsd": 8192,
        "bluray": 25000, "nvme": 1048576, "dna": 1000000
    };
    
    const optimalCapacity = optimalCapacities[product.techId] || 100;
    const capacityScore = Math.min(1, product.capacity / optimalCapacity);
    
    // –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫–æ—Ä —Å –≤–µ—Å–∞–º–∏
    return (
        capacityScore * 0.4 +
        (product.speed / 100) * 0.3 +
        (product.reliability / 100) * 0.3
    );
}

function getOptimalPriceMultiplier(techId) {
    const multipliers = {
        "rom": 3.0, "floppy5": 2.8, "hdd10": 2.5, "cdrom": 2.3,
        "dvd": 2.2, "usb": 2.0, "ssd40": 1.8, "microsd": 1.7,
        "bluray": 1.6, "nvme": 1.5, "dna": 1.4
    };
    return multipliers[techId] || 2.5;
}

function getBaseSales(techId) {
    const salesMap = {
        "rom": 1, "floppy5": 2, "hdd10": 3, "cdrom": 4,
        "dvd": 5, "usb": 6, "microsd": 7, "ssd40": 8,
        "nvme": 9, "dna": 10, "bluray": 7.5
    };
    return salesMap[techId] || 1;
}

function processTaxes() {
    const taxAmount = Math.floor(gameState.periodStats.profit * countries[gameState.country].taxRate);
    
    if (taxAmount > 0) {
        gameState.balance -= taxAmount;
        gameState.periodStats.tax = taxAmount;
        gameState.periodStats.netProfit = gameState.periodStats.profit - taxAmount;
        
        gameState.periodStats.income = 0;
        gameState.periodStats.expense = 0;
        gameState.periodStats.profit = 0;
    }
}

function updateGameUI() {
    elements.currentCompanyName.textContent = gameState.companyName;
    elements.currentCeoName.textContent = `CEO: ${gameState.ceoName}`;
    elements.currentDate.textContent = formatDate(gameState.day, gameState.month, gameState.year);
    elements.currentBalance.textContent = `$${formatNumber(gameState.balance)}`;
    elements.currentXP.textContent = formatNumber(gameState.xp);
    elements.currentQuarter.textContent = `Q${gameState.quarter}`;

    elements.currentCountry.textContent = `${countries[gameState.country].name}`;
    
    elements.pauseBtn.textContent = gameState.paused ? "–°—Ç–∞—Ä—Ç" : "–ü–∞—É–∑–∞";
    
    elements.periodIncome.textContent = `$${formatNumber(gameState.periodStats.income)}`;
    elements.periodExpense.textContent = `$${formatNumber(gameState.periodStats.expense)}`;
    elements.periodProfit.textContent = `$${formatNumber(gameState.periodStats.profit)}`;
    elements.periodTax.textContent = `$${formatNumber(gameState.periodStats.tax)}`;
    elements.periodNetProfit.textContent = `$${formatNumber(gameState.periodStats.netProfit)}`;
    
    updateStoreTab();
    updateProductPortfolio();
}

function formatDate(day, month, year) {
    return `${day.toString().padStart(2, '0')}.${month.toString().padStart(2, '0')}.${year}`;
}

function formatNumber(num) {
    if (num >= 1000000000000) return (num / 1000000000000).toFixed(1) + 'T';
    if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
    return num.toString();
}

function getDaysInMonth(month, year) {
    if (month === 2) return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0) ? 29 : 28;
    return [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month - 1];
}

// ==================== –¢–ï–•–ù–û–õ–û–ì–ò–ò –ò –ü–†–û–ò–ó–í–û–î–°–¢–í–û ====================

function initTechTree() {
    elements.techList.innerHTML = '';
    
    technologies.forEach(tech => {
        const isResearched = gameState.researchedTechs.includes(tech.id);
        const canResearch = tech.year <= gameState.year && 
                          gameState.balance >= tech.researchCost && 
                          gameState.xp >= tech.xpCost;
        
        const techItem = document.createElement('div');
        techItem.className = 'tech-item';
        techItem.innerHTML = `
            <div class="tech-header">
                <h4>${tech.name}</h4>
                <span class="tech-year">${tech.year}</span>
            </div>
            <div class="tech-cost">
                <div>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ: $${tech.researchCost.toLocaleString()} + ${tech.xpCost} XP</div>
                <div>–ë–∞–∑–æ–≤—ã–µ –æ—á–∫–∏: ${tech.points}</div>
            </div>
            <div style="margin-top: 10px;">
                ${isResearched ? 
                    `<button onclick="openProductionModal('${tech.id}')">–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å</button>` : 
                    `<button onclick="researchTech('${tech.id}')" ${!canResearch ? 'disabled' : ''}>–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å</button>`
                }
            </div>
        `;
        
        elements.techList.appendChild(techItem);
    });
}

function researchTech(techId) {
    const tech = technologies.find(t => t.id === techId);
    if (!tech) return;
    
    if (gameState.balance < tech.researchCost || gameState.xp < tech.xpCost) {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –∏–ª–∏ –æ–ø—ã—Ç–∞", "error");
        return;
    }
    
    gameState.balance -= tech.researchCost;
    gameState.xp -= tech.xpCost;
    gameState.researchedTechs.push(techId);
    
    gameState.periodStats.expense += tech.researchCost;
    gameState.xp += Math.floor(tech.researchCost / 50);
    
    updateGameUI();
    initTechTree();
    
    showNotification(`–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è "${tech.name}" –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞!`, "success");
}

function about() {
    alert(`
        Storage Tycoon
    
        –°–æ–∑–¥–∞—Ç–µ–ª—å:
    - Michael
        
        –í–µ—Ä—Å–∏—è: 1.0.0
    `);
}

function openProductionModal(techId) {
    currentTech = technologies.find(t => t.id === techId);
    if (!currentTech) return;
    
    // –°–û–ó–î–ê–ï–ú –ú–û–î–ê–õ–ö–£ –ù–ê–ü–†–Ø–ú–£–Æ
    const productionModal = document.getElementById('productionModal');
    productionModal.innerHTML = `
        <div class="modal-content screen">
            <div class="modal-header">
                <h3>–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ ${currentTech.name}</h3>
                <button class="close-modal" onclick="document.getElementById('productionModal').style.display='none'">&times;</button>
            </div>
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏:</label>
                    <input type="text" id="modelName" value="${currentTech.name} ${Math.floor(Math.random() * 900) + 100}" 
                           style="width: 100%; padding: 10px; background: #002200; border: 1px solid #0a0; color: #0f0;">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–Å–º–∫–æ—Å—Ç—å: <span id="capacityValue">50</span> <span id="capacityUnit">MB</span></span>
                        <span>–û—á–∫–æ–≤: ${currentTech.points}</span>
                    </div>
                    <input type="range" id="capacitySlider" min="10" max="1000000" value="50">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–°–∫–æ—Ä–æ—Å—Ç—å: <span id="speedValue">50</span></span>
                    </div>
                    <input type="range" id="speedSlider" min="10" max="100" value="50">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å: <span id="reliabilityValue">50</span></span>
                    </div>
                    <input type="range" id="reliabilitySlider" min="10" max="100" value="50">
                </div>
                
                <div class="finance-stats" style="margin: 20px 0;">
                    <div class="finance-item">
                        <span>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                        <span id="productionCost">$1,000</span>
                    </div>
                    <div class="finance-item">
                        <span>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞:</span>
                        <span id="suggestedPrice">$2,500</span>
                    </div>
                </div>
                
                <button onclick="launchProduction()" style="width: 100%; padding: 15px;">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</button>
            </div>
        </div>
    `;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–ª–∞–π–¥–µ—Ä—ã
    setTimeout(() => {
        ['capacitySlider', 'speedSlider', 'reliabilitySlider'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', updateProductionStats);
            }
        });
        updateProductionStats();
    }, 100);
    
    productionModal.style.display = 'flex';
}

function updateProductionStats() {
    if (!currentTech) return;
    
    const capacitySlider = document.getElementById('capacitySlider');
    const speedSlider = document.getElementById('speedSlider');
    const reliabilitySlider = document.getElementById('reliabilitySlider');
    
    if (!capacitySlider || !speedSlider || !reliabilitySlider) return;
    
    const capacity = parseInt(capacitySlider.value) || 50;
    const speed = parseInt(speedSlider.value) || 50;
    const reliability = parseInt(reliabilitySlider.value) || 50;
    
    const capacityValue = document.getElementById('capacityValue');
    const capacityUnit = document.getElementById('capacityUnit');
    const speedValue = document.getElementById('speedValue');
    const reliabilityValue = document.getElementById('reliabilityValue');
    
    if (capacityValue) capacityValue.textContent = capacity;
    if (speedValue) speedValue.textContent = speed;
    if (reliabilityValue) reliabilityValue.textContent = reliability;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –µ–º–∫–æ—Å—Ç–∏
    if (capacityUnit) {
        if (capacity >= 1000000) {
            capacityUnit.textContent = 'TB';
            capacityValue.textContent = (capacity / 1000000).toFixed(1);
        } else if (capacity >= 1000) {
            capacityUnit.textContent = 'GB';
            capacityValue.textContent = (capacity / 1000).toFixed(1);
        } else {
            capacityUnit.textContent = 'MB';
        }
    }
    
    const cost = Math.round(currentTech.baseCost * (capacity + speed + reliability) / 50);
    const suggestedPrice = Math.round(cost * 2.5);
    
    const productionCost = document.getElementById('productionCost');
    const suggestedPriceElem = document.getElementById('suggestedPrice');
    
    if (productionCost) productionCost.textContent = `$${cost.toLocaleString()}`;
    if (suggestedPriceElem) suggestedPriceElem.textContent = `$${suggestedPrice.toLocaleString()}`;
}

function launchProduction() {
    const modelNameInput = document.getElementById('modelName');
    if (!modelNameInput) {
        showNotification("–û—à–∏–±–∫–∞: –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", "error");
        return;
    }
    
    const modelName = modelNameInput.value.trim();
    if (!modelName) {
        showNotification("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏", "error");
        return;
    }
    
    const capacitySlider = document.getElementById('capacitySlider');
    const speedSlider = document.getElementById('speedSlider');
    const reliabilitySlider = document.getElementById('reliabilitySlider');
    
    if (!capacitySlider || !speedSlider || !reliabilitySlider) {
        showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤", "error");
        return;
    }
    
    const capacity = parseInt(capacitySlider.value);
    const speed = parseInt(speedSlider.value);
    const reliability = parseInt(reliabilitySlider.value);
    
    const cost = Math.round(currentTech.baseCost * (capacity + speed + reliability) / 50);
    const price = Math.round(cost * 2.5);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤
    const productionCost = cost;
    if (gameState.balance < productionCost) {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞", "error");
        return;
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
    const product = {
        id: Date.now(),
        techId: currentTech.id,
        name: modelName,
        techName: currentTech.name,
        capacity: capacity,
        speed: speed,
        reliability: reliability,
        cost: cost,
        price: price,
        sales: 0,
        totalSales: 0,
        age: 0,
        revenue: 0,
        createdAt: gameState.year + (gameState.month / 12),
        onSale: true
    };
    
    gameState.balance -= productionCost;
    gameState.periodStats.expense += productionCost;
    gameState.products.push(product);
    gameState.totalProducts++;
    gameState.xp += Math.floor(cost / 10);
    
    document.getElementById('productionModal').style.display = 'none';
    updateGameUI();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
    if (gameState.totalProducts === 1) {
        unlockAchievement("first_product");
    }
    
    showNotification(`–ú–æ–¥–µ–ª—å "${modelName}" –∑–∞–ø—É—â–µ–Ω–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ!`, "success");
}

// ==================== –ò–ù–¢–ï–†–§–ï–ô–° ====================

function switchTab(tabName) {
    elements.tabs.forEach(tab => tab.classList.remove('active'));
    elements.tabContents.forEach(content => content.classList.remove('active'));
    
    document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    document.getElementById(`${tabName}Tab`).classList.add('active');
    
    if (tabName === 'store') updateStoreTab();
    if (tabName === 'marketing') updateMarketingTab();
    if (tabName === 'production') updateProductionTab();
    if (tabName === 'achievements') updateAchievementsTab();
    if (tabName === 'market') updateMarketTab();
}

function updateMarketTab() {
    elements.marketTab.innerHTML = `
    <h3>–ú–∞–≥–∞–∑–∏–Ω—ã</h3>
    <div id="marketStores">
        <div class="market">
            <h4>BNS</h4>
            <p>–ù–∞—Ä–æ–¥–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω –≤—Å—è–∫–æ–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Ñ–∏–≥–Ω–∏.</p>
            <p>–î–æ—Ö–æ–¥: $1000 –≤ –º–µ—Å—è—Ü</p>
            <button id="bnsMarketApply">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—É–¥–∞ –ø–æ—Å—Ç–∞–≤–∫—É</button>
        </div>
    </div>
    `;
}

function updateSingleProductInStore(product) {
    const productElement = document.querySelector(`[data-product-id="${product.id}"]`);
    if (!productElement) return;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∂–∏
    const profitMargin = Math.round((product.price - product.cost) / product.cost * 100);
    const profitInfo = productElement.querySelector('.profit-info');
    if (profitInfo) {
        profitInfo.textContent = `–ú–∞—Ä–∂–∞: ${profitMargin}%`;
        profitInfo.style.color = profitMargin > 100 ? '#0f0' : 
                                profitMargin > 50 ? '#ff0' : 
                                profitMargin > 20 ? '#8f8' : 
                                profitMargin > 0 ? '#f80' : '#f00';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã
    const priceInput = productElement.querySelector('.price-input');
    if (priceInput) {
        priceInput.value = product.price;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–¥–∞–∂–∞—Ö, –µ—Å–ª–∏ –µ—Å—Ç—å
    const salesInfo = productElement.querySelector('.sales-info');
    if (salesInfo) {
        const estimatedSales = calculateEstimatedSales(product);
        salesInfo.textContent = `~${estimatedSales} –ø—Ä–æ–¥–∞–∂/–¥–µ–Ω—å`;
    }
}

function updateStoreTab() {
    const productsOnSale = gameState.products.filter(p => p.onSale);
    
    if (productsOnSale.length === 0) {
        elements.storeProducts.innerHTML = '<p id="noProductsMsg">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ø—Ä–æ–¥–∞–∂–µ.</p>';
        return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å, –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
    const activeElement = document.activeElement;
    const focusedInputId = activeElement && activeElement.id ? activeElement.id : null;
    let focusedValue = null;
    let cursorPosition = 0;
    if (activeElement && activeElement.tagName === 'INPUT' && activeElement.type === 'number') {
        focusedValue = activeElement.value;
        cursorPosition = activeElement.selectionStart || 0;
    }
    
    elements.storeProducts.innerHTML = productsOnSale.map(product => {
        const qualityScore = calculateQualityScore(product);
        const qualityColor = qualityScore > 0.8 ? '#0f0' : qualityScore > 0.6 ? '#ff0' : '#f00';
        const qualityText = qualityScore > 0.8 ? '–û—Ç–ª–∏—á–Ω–æ–µ' : qualityScore > 0.6 ? '–•–æ—Ä–æ—à–µ–µ' : '–°—Ä–µ–¥–Ω–µ–µ';
        const profitMargin = Math.round((product.price - product.cost) / product.cost * 100);
        
        return `
        <div class="product-card" data-product-id="${product.id}">
            <div class="product-model">${product.name}</div>
            <div style="color: ${qualityColor}; margin-bottom: 5px;">
                ${qualityText} (${Math.round(qualityScore * 100)}%)
            </div>
            <div class="profit-info" style="color: ${profitMargin > 100 ? '#0f0' :
                                              profitMargin > 50 ? '#ff0' :
                                              profitMargin > 20 ? '#8f8' :
                                              profitMargin > 0 ? '#f80' : '#f00'};
                                           font-size: 0.9rem; margin-bottom: 10px;">
                –ú–∞—Ä–∂–∞: ${profitMargin}%
            </div>
            
            <div class="product-specs">
                <div class="spec" title="–í–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π">
                    <span class="spec-value">${product.capacity}</span>
                    <span class="spec-label">–Å–º–∫–æ—Å—Ç—å</span>
                </div>
                <div class="spec" title="–í–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã">
                    <span class="spec-value">${product.speed}</span>
                    <span class="spec-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                </div>
                <div class="spec" title="–í–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—é">
                    <span class="spec-value">${product.reliability}</span>
                    <span class="spec-label">–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å</span>
                </div>
            </div>
            
            <div style="margin: 10px 0; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 5px; font-size: 0.9rem;">
                <div>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: $${product.cost}</div>
                <div>–ü—Ä–æ–¥–∞–Ω–æ: ${Math.round(product.totalSales)} —à—Ç.</div>
            </div>
            
            <div class="price-controls">
                <input type="number"
                       id="price-input-${product.id}"
                       value="${product.price}"
                       class="price-input"
                       min="${product.cost}"
                       max="${product.cost * 20}"
                       step="10">
                <button onclick="applyNewPrice(${product.id})">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É</button>
            </div>
            
            <div style="margin-top: 10px; font-size: 0.85rem; color: #8f8;">
                <div>–í—ã—Ä—É—á–∫–∞: $${formatNumber(product.revenue)}</div>
                <div>–í–æ–∑—Ä–∞—Å—Ç: ${product.age} –¥–Ω–µ–π</div>
            </div>
        </div>
        `;
    }).join('');
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å, –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
    if (focusedInputId) {
        const inputToFocus = document.getElementById(focusedInputId);
        if (inputToFocus) {
            inputToFocus.focus();
            if (focusedValue !== null) {
                inputToFocus.value = focusedValue;
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä –≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π —Ç–æ–∂–µ
                if (inputToFocus.type === 'number' || inputToFocus.type === 'text' || inputToFocus.type === 'search' || inputToFocus.type === 'tel' || inputToFocus.type === 'url') {
                    inputToFocus.setSelectionRange(cursorPosition, cursorPosition);
                }
            }
        }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
    setTimeout(() => {
        productsOnSale.forEach(product => {
            const input = document.getElementById(`price-input-${product.id}`);
            if (input) {
                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
                const newInput = input.cloneNode(true);
                input.parentNode.replaceChild(newInput, input);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫ –Ω–æ–≤–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                newInput.addEventListener('change', function() {
                    updateProductPrice(product.id, this.value);
                });
                
                // Enter —Ç–∞–∫–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ü–µ–Ω—É
                newInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        updateProductPrice(product.id, this.value);
                    }
                });
            }
        });
    }, 100);
}

function calculateProfitMargin(product) {
    return Math.round((product.price - product.cost) / product.cost * 100);
}

function calculateDailySales(product) {
    const qualityScore = calculateQualityScore(product);
    const baseSales = getBaseSales(product.techId);
    const priceFactor = 1 - Math.abs(product.price - product.cost * 2.5) / (product.cost * 2.5);
    
    return Math.round(baseSales * qualityScore * priceFactor * 0.8);
}

function updateProductPrice(productId, newPrice = null) {
    const product = gameState.products.find(p => p.id === productId);
    if (!product) {
        console.error('–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:', productId);
        return;
    }
    
    // –ï—Å–ª–∏ –Ω–æ–≤–∞—è —Ü–µ–Ω–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞
    if (newPrice === null) {
        const input = document.getElementById(`price-input-${productId}`);
        if (input) {
            newPrice = parseInt(input.value);
        } else {
            newPrice = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Ü–µ–Ω—É:", product.price);
            if (!newPrice) return;
            newPrice = parseInt(newPrice);
        }
    } else {
        newPrice = parseInt(newPrice);
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –≤–∞–ª–∏–¥–Ω–æ–µ —á–∏—Å–ª–æ
    if (isNaN(newPrice) || newPrice <= 0) {
        showNotification("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É", "error");
        return;
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    const oldPrice = product.price;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é —Ü–µ–Ω—É
    product.price = newPrice;
    
    // –õ–æ–≥–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ
    console.log(`–¶–µ–Ω–∞ ${product.name} –∏–∑–º–µ–Ω–µ–Ω–∞: $${oldPrice} -> $${newPrice}`);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏
    updateSingleProductInStore(product);
    
    showNotification(`–¶–µ–Ω–∞ –Ω–∞ "${product.name}" –æ–±–Ω–æ–≤–ª–µ–Ω–∞: $${oldPrice} ‚Üí $${newPrice}`, "info");
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç, –∞ –Ω–µ –≤–µ—Å—å UI
    // updateGameUI(); // –£–±–∏—Ä–∞–µ–º –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
}

// –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ –∫–Ω–æ–ø–∫–µ)
function applyNewPrice(productId) {
    const input = document.getElementById(`price-input-${productId}`);
    if (input) {
        updateProductPrice(productId, input.value);
    }
}

function debugProductSales(productId) {
    const product = gameState.products.find(p => p.id === productId);
    if (!product) {
        console.error('–ü—Ä–æ–¥—É–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    console.log('=== –î–ï–ë–ê–ì –ü–†–û–î–ê–ñ –ü–†–û–î–£–ö–¢–ê ===');
    console.log(`–ù–∞–∑–≤–∞–Ω–∏–µ: ${product.name}`);
    console.log(`–¶–µ–Ω–∞: $${product.price}, –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: $${product.cost}`);
    console.log(`–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: –Å–º–∫–æ—Å—Ç—å ${product.capacity}, –°–∫–æ—Ä–æ—Å—Ç—å ${product.speed}, –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å ${product.reliability}`);
    console.log(`–í–æ–∑—Ä–∞—Å—Ç: ${product.age} –¥–Ω–µ–π`);
    console.log(`–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è: ${product.techName} (${product.techId})`);
    console.log(`–í—Å–µ–≥–æ –ø—Ä–æ–¥–∞–∂: ${product.totalSales}`);
    console.log(`–°—Ç–∞—Ç—É—Å: ${product.onSale ? '–í –ø—Ä–æ–¥–∞–∂–µ' : '–ù–µ –≤ –ø—Ä–æ–¥–∞–∂–µ'}`);
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–∫—Ç–æ—Ä—ã –ø—Ä–æ–¥–∞–∂
    const optimalPrice = product.cost * 2.5;
    const priceDeviation = Math.abs(product.price - optimalPrice) / optimalPrice;
    const priceFactor = Math.max(0.1, 1 - priceDeviation * 2);
    
    const qualityScore = (product.capacity * 0.4 + product.speed * 0.3 + product.reliability * 0.3) / 100;
    const qualityFactor = 0.5 + qualityScore * 0.5;
    
    let ageFactor = 1.5;
    if (product.age > 180) ageFactor = 1.0;
    if (product.age > 365) ageFactor = 0.5;
    
    const baseSales = getBaseSales(product.techId);
    const marketGrowth = 1 + (gameState.year - 1980) * 0.03;
    
    console.log('\n--- –§–ê–ö–¢–û–†–´ –ü–†–û–î–ê–ñ ---');
    console.log(`–ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–¥–∞–∂–∞: ${baseSales}`);
    console.log(`–¶–µ–Ω–æ–≤–æ–π —Ñ–∞–∫—Ç–æ—Ä: ${priceFactor.toFixed(2)} (${priceFactor < 0.3 ? '–°–õ–ò–®–ö–û–ú –í–´–°–û–ö–ê–Ø –¶–ï–ù–ê' : 'OK'})`);
    console.log(`–§–∞–∫—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞: ${qualityFactor.toFixed(2)} (${qualityFactor < 0.6 ? '–ù–ò–ó–ö–û–ï –ö–ê–ß–ï–°–¢–í–û' : 'OK'})`);
    console.log(`–§–∞–∫—Ç–æ—Ä –≤–æ–∑—Ä–∞—Å—Ç–∞: ${ageFactor} (${ageFactor < 0.8 ? '–°–¢–ê–†–´–ô –ü–†–û–î–£–ö–¢' : 'OK'})`);
    console.log(`–†–æ—Å—Ç —Ä—ã–Ω–∫–∞: ${marketGrowth.toFixed(2)}`);
    
    const estimatedDailySales = Math.round(baseSales * priceFactor * qualityFactor * ageFactor * marketGrowth * 1.0);
    console.log(`\n–û–¶–ï–ù–ö–ê –î–ù–ï–í–ù–´–• –ü–†–û–î–ê–ñ: ${estimatedDailySales} —à—Ç.`);
    
    // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    console.log('\n--- –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ---');
    if (priceFactor < 0.3) {
        console.log(`‚ùó –°–ù–ò–ó–¨–¢–ï –¶–ï–ù–£: –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ $${Math.round(optimalPrice)} (—Å–µ–π—á–∞—Å $${product.price})`);
    }
    if (qualityFactor < 0.6) {
        console.log(`‚ùó –£–õ–£–ß–®–ò–¢–ï –ö–ê–ß–ï–°–¢–í–û: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–µ`);
    }
    if (ageFactor < 0.8) {
        console.log(`‚ùó –ü–†–û–î–£–ö–¢ –£–°–¢–ê–†–ï–õ: —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å`);
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    showNotification(`–ü—Ä–æ–¥–∞–∂–∏ ${product.name}: ~${estimatedDailySales} —à—Ç/–¥–µ–Ω—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.`, "info");
}

function updateMarketingTab() {
    if (gameState.year < 1990) {
        elements.marketingCampaigns.innerHTML = `
            <div class="tech-item">
                <h4>–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</h4>
                <p style="color: #8f8;">–î–æ—Å—Ç—É–ø–µ–Ω —Å 1990 –≥–æ–¥–∞</p>
                <p>–î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑: ${1990 - gameState.year} –ª–µ—Ç</p>
            </div>
        `;
        return;
    }
    
    const campaigns = [
        { id: "print_ads", name: "–ü–µ—á–∞—Ç–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞", cost: 5000, effect: 1.2, duration: 90 },
        { id: "tv_commercial", name: "–¢–í-—Ä–µ–∫–ª–∞–º–∞", cost: 20000, effect: 1.5, duration: 180 },
        { id: "online_ads", name: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ä–µ–∫–ª–∞–º–∞", cost: 10000, effect: 1.4, duration: 120, year: 1995 },
        { id: "trade_show", name: "–í—ã—Å—Ç–∞–≤–∫–∞", cost: 15000, effect: 1.3, duration: 60 },
        { id: "social_media", name: "–°–æ—Ü—Å–µ—Ç–∏", cost: 8000, effect: 1.6, duration: 150, year: 2004 }
    ];
    
    elements.marketingCampaigns.innerHTML = `
        <h3>–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏</h3>
        <p style="color: #8f8; margin-bottom: 20px;">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –ø—Ä–æ–¥–∞–∂–∏</p>
        
        <div style="display: grid; gap: 15px;">
            ${campaigns.map(campaign => {
                const available = !campaign.year || gameState.year >= campaign.year;
                const active = gameState.marketingCampaigns.some(c => c.id === campaign.id && c.active);
                
                return `
                    <div class="tech-item" style="${!available ? 'opacity: 0.5;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4>${campaign.name}</h4>
                                <p style="color: #8f8;">+${Math.round((campaign.effect - 1) * 100)}% –∫ –ø—Ä–æ–¥–∞–∂–∞–º</p>
                                <p style="color: #ff8;">–°—Ç–æ–∏–º–æ—Å—Ç—å: $${campaign.cost}</p>
                            </div>
                            <div>
                                ${available ? 
                                    `<button onclick="${active ? 'stopCampaign' : 'startCampaign'}('${campaign.id}')"
                                             style="${active ? 'background: #660000;' : ''}">
                                        ${active ? '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å' : '–ó–∞–ø—É—Å—Ç–∏—Ç—å'}
                                    </button>` :
                                    `<span style="color: #888;">–° ${campaign.year} –≥–æ–¥–∞</span>`
                                }
                            </div>
                        </div>
                        ${active ? `
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #0a0;">
                                <div style="color: #8f8;">
                                    –û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: ${gameState.marketingCampaigns.find(c => c.id === campaign.id).daysLeft}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('')}
        </div>
    `;
}
function getCampaignData(campaignId) {
    const campaigns = [
        { id: "print_ads", name: "–ü–µ—á–∞—Ç–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞", cost: 5000, effect: 1.2, duration: 90 },
        { id: "tv_commercial", name: "–¢–í-—Ä–µ–∫–ª–∞–º–∞", cost: 20000, effect: 1.5, duration: 180 },
        { id: "online_ads", name: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ä–µ–∫–ª–∞–º–∞", cost: 10000, effect: 1.4, duration: 120, year: 1995 },
        { id: "trade_show", name: "–í—ã—Å—Ç–∞–≤–∫–∞", cost: 15000, effect: 1.3, duration: 60 },
        { id: "social_media", name: "–°–æ—Ü—Å–µ—Ç–∏", cost: 8000, effect: 1.6, duration: 150, year: 2004 }
    ];
    
    return campaigns.find(c => c.id === campaignId);
}

function startCampaign(campaignId) {
    const campaign = getCampaignData(campaignId);
    if (!campaign || gameState.balance < campaign.cost) {
        showNotification("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤", "error");
        return;
    }
    
    gameState.balance -= campaign.cost;
    gameState.periodStats.expense += campaign.cost;
    
    gameState.marketingCampaigns.push({
        id: campaignId,
        active: true,
        daysLeft: campaign.duration,
        effect: campaign.effect
    });
    
    updateMarketingTab();
    showNotification(`–ö–∞–º–ø–∞–Ω–∏—è "${campaign.name}" –∑–∞–ø—É—â–µ–Ω–∞!`, "success");
}


function stopCampaign(campaignId) {
    const index = gameState.marketingCampaigns.findIndex(c => c.id === campaignId);
    if (index !== -1) {
        gameState.marketingCampaigns.splice(index, 1);
        updateMarketingTab();
        showNotification("–ö–∞–º–ø–∞–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞", "info");
    }
    
}
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
function updateMarketingCampaigns() {
    // –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
    gameState.marketingCampaigns.forEach(campaign => {
        if (campaign.active && campaign.daysLeft > 0) {
            campaign.daysLeft--;
            
            // –ï—Å–ª–∏ –∫–∞–º–ø–∞–Ω–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –µ—ë
            if (campaign.daysLeft <= 0) {
                campaign.active = false;
                showNotification(`–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è –∫–∞–º–ø–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞`, "info");
            }
        }
    });
    
    // –£–¥–∞–ª—è–µ–º –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏
    gameState.marketingCampaigns = gameState.marketingCampaigns.filter(campaign => campaign.active || campaign.daysLeft > 0);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∫–ª–∞–¥–∫—É –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞, –µ—Å–ª–∏ –æ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞
    const marketingTab = document.getElementById('marketingTab');
    if (marketingTab && marketingTab.classList.contains('active')) {
        updateMarketingTab();
    }
}

function updateProductionTab() {
    elements.productionInterface.innerHTML = `
        <div class="tech-item">
            <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h4>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 10px;">
                <div>
                    <div style="color: #8f8;">–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                    <div style="font-size: 1.5rem; color: #0f0;">${gameState.products.length}</div>
                </div>
                <div>
                    <div style="color: #8f8;">–ü—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ø—Ä–æ–¥–∞–∂–µ</div>
                    <div style="font-size: 1.5rem; color: #0f0;">${gameState.products.filter(p => p.onSale).length}</div>
                </div>
            </div>
        </div>
    `;
}

function updateProductPortfolio() {
    const recentProducts = [...gameState.products]
        .sort((a, b) => b.createdAt - a.createdAt)
        .slice(0, 3);
    
    elements.productPortfolio.innerHTML = recentProducts.length === 0 ? 
        '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤.</p>' :
        recentProducts.map(product => `
            <div class="tech-item" style="margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <div style="font-weight: bold; color: #8f8;">${product.name}</div>
                        <div style="font-size: 0.9rem; color: #8f8;">${product.techName}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: #0f0;">$${formatNumber(product.revenue)}</div>
                        <div style="font-size: 0.9rem;">${Math.round(product.totalSales)} –ø—Ä–æ–¥–∞–∂</div>
                    </div>
                </div>
            </div>
        `).join('');
}

// ==================== –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ====================

function updateAchievementsTab() {
    elements.achievementsList.innerHTML = achievementsList.map(achievement => {
        const unlocked = gameState.achievements.includes(achievement.id);
        return `
            <div class="tech-item" style="${unlocked ? 'border-color: #0f0;' : 'opacity: 0.7;'}">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4 style="color: ${unlocked ? '#0f0' : '#8f8'}">${achievement.name}</h4>
                        <p style="color: #8f8; font-size: 0.9rem;">${achievement.description}</p>
                    </div>
                    <div style="text-align: right;">
                        ${unlocked ? 
                            `<span style="color: #0f0;">‚úÖ –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>` :
                            `<span style="color: #888;">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</span>`
                        }
                    </div>
                </div>
                ${unlocked ? `
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #0a0;">
                        <div style="color: #ff8;">–ù–∞–≥—Ä–∞–¥–∞: $${achievement.reward.toLocaleString()} + ${achievement.xp} XP</div>
                    </div>
                ` : ''}
            </div>
        `;
    }).join('');
}

function checkAchievements() {
    achievementsList.forEach(achievement => {
        if (gameState.achievements.includes(achievement.id)) return;
        
        let unlocked = false;
        
        switch(achievement.id) {
            case "first_product":
                unlocked = gameState.totalProducts >= 1;
                break;
            case "millionaire":
                unlocked = gameState.totalRevenue >= 1000000;
                break;
            case "tech_master":
                unlocked = gameState.researchedTechs.length === technologies.length;
                break;
            case "year_2000":
                unlocked = gameState.year >= 2000;
                break;
            case "product_10":
                unlocked = gameState.totalProducts >= 10;
                break;
            case "gaben":
                gameState.products.forEach(product => {
                    if (product.name.toLowerCase().includes("—à–æ–∫–æ–ª–∞–¥–∫–∞")) {
                        unlocked = true;
                    }
                });
                break;
            case "year_2014":
                unlocked = gameState.year >= 2014;
                break;
            case "belarus":
                gameState.products.forEach(product => {
                    if (product.name.toLowerCase().includes("–∫–∞—Ä—Ç–æ—à–∫–∞")) {
                        unlocked = true;
                    }
                });
                break;
        }
        
        if (unlocked) {
            unlockAchievement(achievement.id);
        }
    });
}

function unlockAchievement(achievementId) {
    if (gameState.achievements.includes(achievementId)) return;
    
    const achievement = achievementsList.find(a => a.id === achievementId);
    if (!achievement) return;
    
    gameState.achievements.push(achievementId);
    gameState.balance += achievement.reward;
    gameState.xp += achievement.xp;
    
    showNotification(`–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: ${achievement.name}! +$${achievement.reward} +${achievement.xp} XP`, "success");
    updateAchievementsTab();
}

// ==================== –ì–†–ê–§–ò–ö ====================

function initSalesChart() {
    const ctx = elements.salesChart.getContext('2d');
    
    salesChartInstance = {
        ctx: ctx,
        data: []
    };
}

function updateSalesChart() {
    if (!salesChartInstance) return;
    
    const ctx = salesChartInstance.ctx;
    const canvas = elements.salesChart;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    const recentSales = gameState.salesHistory.slice(-30);
    if (recentSales.length === 0) return;
    
    const maxRevenue = Math.max(...recentSales.map(s => s.revenue), 1);
    const chartHeight = canvas.height - 20;
    const chartWidth = canvas.width - 40;
    const barWidth = chartWidth / recentSales.length;
    
    // –°–µ—Ç–∫–∞
    ctx.strokeStyle = 'rgba(0, 255, 0, 0.2)';
    ctx.lineWidth = 1;
    
    for (let i = 0; i <= 4; i++) {
        const y = chartHeight * (i / 4) + 10;
        ctx.beginPath();
        ctx.moveTo(30, y);
        ctx.lineTo(canvas.width - 10, y);
        ctx.stroke();
        
        ctx.fillStyle = '#8f8';
        ctx.font = '10px monospace';
        ctx.fillText(`$${Math.round(maxRevenue * (1 - i/4)).toLocaleString()}`, 5, y + 3);
    }
    
    // –°—Ç–æ–ª–±—Ü—ã
    recentSales.forEach((sale, index) => {
        const barHeight = (sale.revenue / maxRevenue) * chartHeight;
        const x = 30 + index * barWidth;
        const y = canvas.height - barHeight - 10;
        
        const gradient = ctx.createLinearGradient(0, y, 0, y + barHeight);
        gradient.addColorStop(0, 'rgba(0, 255, 0, 0.8)');
        gradient.addColorStop(1, 'rgba(0, 255, 0, 0.2)');
        
        ctx.fillStyle = gradient;
        ctx.fillRect(x, y, barWidth - 2, barHeight);
        
        ctx.strokeStyle = '#0f0';
        ctx.lineWidth = 1;
        ctx.strokeRect(x, y, barWidth - 2, barHeight);
        
        ctx.fillStyle = '#8f8';
        ctx.font = '8px monospace';
        ctx.textAlign = 'center';
        ctx.fillText(`${sale.day}/${sale.month}`, x + barWidth/2 - 1, canvas.height - 5);
    });
    
    ctx.fillStyle = '#0f0';
    ctx.font = '12px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π', canvas.width / 2, 15);
}

// ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï –ò –ó–ê–ì–†–£–ó–ö–ê ====================

function showSaveModal() {
    // –°–û–ó–î–ê–ô —ç–ª–µ–º–µ–Ω—Ç –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    const modalContent = document.getElementById('saveLoadModalContent');
    if (!modalContent) {
        // –°–æ–∑–¥–∞–µ–º HTML –Ω–∞–ø—Ä—è–º—É—é
        document.getElementById('saveLoadModal').innerHTML = `
            <div class="modal-content screen">
                <div class="modal-header">
                    <h3>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã</h3>
                    <button class="close-modal" onclick="document.getElementById('saveLoadModal').style.display='none'">&times;</button>
                </div>
                <div style="padding: 20px;">
                    <p>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏–≥—Ä—ã:</p>
                    <textarea id="saveCode" rows="8" style="width: 100%; background: #002200; color: #0f0; padding: 10px; margin: 15px 0; border: 1px solid #0a0;"></textarea>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="copySaveCode()" style="flex: 1;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
                        <button onclick="downloadSaveFile()" style="flex: 1;">–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</button>
                    </div>
                </div>
            </div>
        `;
        
        const saveData = {
            version: gameState.version,
            gameState: gameState,
            timestamp: Date.now()
        };
        
        const encryptedData = SaveEncryption.encrypt(saveData);
        document.getElementById('saveCode').value = encryptedData;
    }
    
    document.getElementById('saveLoadModal').style.display = 'flex';
}

function showLoadModal() {
    // –°–û–ó–î–ê–ô —ç–ª–µ–º–µ–Ω—Ç –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    const modalContent = document.getElementById('saveLoadModalContent');
    if (!modalContent) {
        // –°–æ–∑–¥–∞–µ–º HTML –Ω–∞–ø—Ä—è–º—É—é
        document.getElementById('saveLoadModal').innerHTML = `
            <div class="modal-content screen">
                <div class="modal-header">
                    <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã</h3>
                    <button class="close-modal" onclick="document.getElementById('saveLoadModal').style.display='none'">&times;</button>
                </div>
                <div style="padding: 20px;">
                    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å:</p>
                    <textarea id="loadCode" rows="8" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è" 
                              style="width: 100%; background: #002200; color: #0f0; padding: 10px; margin: 15px 0; border: 1px solid #0a0;"></textarea>
                    <p style="text-align: center; margin: 10px 0;">–ò–ª–∏</p>
                    <input type="file" id="loadFile" accept=".storage,.json" 
                           style="width: 100%; margin: 10px 0;">
                    <button onclick="loadGameFromInput()" style="width: 100%; padding: 10px;">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É</button>
                </div>
            </div>
        `;
    }
    
    document.getElementById('saveLoadModal').style.display = 'flex';
}

function copySaveCode() {
    const saveCode = document.getElementById('saveCode');
    saveCode.select();
    document.execCommand('copy');
    showNotification("–ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω", "success");
}

function downloadSaveFile() {
    const saveCode = document.getElementById('saveCode').value;
    const blob = new Blob([saveCode], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `storage_tycoon_${Date.now()}.storage`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification("–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫–∞—á–∞–Ω", "success");
}

function loadGameFromInput() {
    let saveString = '';
    
    if (document.getElementById('loadCode').value) {
        saveString = document.getElementById('loadCode').value.trim();
    } else if (document.getElementById('loadFile').files.length > 0) {
        const file = document.getElementById('loadFile').files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            saveString = e.target.result;
            loadGameData(saveString);
        };
        
        reader.readAsText(file);
        return;
    }
    
    if (saveString) {
        loadGameData(saveString);
    } else {
        showNotification("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª", "error");
    }
}

function loadGameData(saveString) {
    try {
        const saveData = SaveEncryption.decrypt(saveString);
        
        if (saveData.version !== gameState.version) {
            showNotification("–í–µ—Ä—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è", "error");
            return;
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        gameState = saveData.gameState;
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        updateGameUI();
        initTechTree();
        updateStoreTab();
        updateProductPortfolio();
        updateAchievementsTab();
        
        if (gameState.salesHistory.length > 0) {
            updateSalesChart();
        }
        
        elements.saveLoadModal.style.display = 'none';
        showNotification("–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞", "success");
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
        if (gameInterval) clearInterval(gameInterval);
        startGameLoop();
        
    } catch (error) {
        showNotification("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + error.message, "error");
    }
}

// ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================

function showNotification(message, type = "info") {
    const notification = document.createElement('div');
    notification.className = 'notification';
    
    let title = "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ";
    let borderColor = "#0f0";
    
    if (type === "error") {
        title = "–û—à–∏–±–∫–∞";
        borderColor = "#f00";
        notification.classList.add('security-warning');
    } else if (type === "success") {
        title = "–£—Å–ø–µ—Ö";
        borderColor = "#0f0";
    } else if (type === "ad") {
        title = "–†–µ–∫–ª–∞–º–∞";
        borderColor = "#00f";
    }
    
    notification.style.borderColor = borderColor;
    notification.innerHTML = `
        <div class="notification-title">${title}</div>
        <div>${message}</div>
    `;
    
    elements.notificationArea.appendChild(notification);
    
    if (type !== "ad") {
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 10000);
    } else {
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 2000);
    }
}

// ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

function togglePause() {
    gameState.paused = !gameState.paused;
    updateGameUI();
}

function toggleSound() {
    gameState.soundEnabled = !gameState.soundEnabled;
    //elements.soundToggle.textContent = gameState.soundEnabled ? "üîä" : "üîá";
}

function closeAllModals() {
    elements.productionModal.style.display = 'none';
    elements.saveLoadModal.style.display = 'none';
    elements.captchaModal.style.display = 'none';
}

// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
function autoSave() {
    try {
        const saveData = {
            version: gameState.version,
            gameState: gameState,
            timestamp: Date.now()
        };
        
        const encrypted = SaveEncryption.encrypt(saveData);
        localStorage.setItem('storageTycoonAutoSave', encrypted);
    } catch (error) {
        console.warn("–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:", error);
    }
}

// –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞
function tryAutoLoad() {
    try {
        const saved = localStorage.getItem('storageTycoonAutoSave');
        if (saved) {
            const saveData = SaveEncryption.decrypt(saved);
            if (saveData && saveData.gameState) {
                if (confirm("–ù–∞–π–¥–µ–Ω–æ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ. –ó–∞–≥—Ä—É–∑–∏—Ç—å?")) {
                    gameState = saveData.gameState;
                    elements.startScreen.style.display = 'none';
                    elements.gameContainer.style.display = 'grid';
                    updateGameUI();
                    initTechTree();
                    startGameLoop();
                    showNotification("–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ", "info");
                }
            }
        }
    } catch (error) {
        console.warn("–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å:", error);
    }
}

// ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('DOMContentLoaded', () => {
    initGame();
    tryAutoLoad();
    
    // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(autoSave, 30000);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –∏—Ö
    window.addEventListener('click', (e) => {
        if (e.target === elements.productionModal) elements.productionModal.style.display = 'none';
        if (e.target === elements.saveLoadModal) elements.saveLoadModal.style.display = 'none';
        if (e.target === elements.captchaModal) elements.captchaModal.style.display = 'none';
    });
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
window.addEventListener('error', function(e) {
    console.error('–û—à–∏–±–∫–∞ –∏–≥—Ä—ã:', e);
    
    // –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    setTimeout(() => {
        if (confirm("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è?")) {
            tryAutoLoad();
        }
    }, 1000);
});

// –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('beforeunload', function(e) {
    autoSave();
    
    if (gameState && gameState.balance > 1000) {
        e.preventDefault();
        e.returnValue = '–ò–≥—Ä–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–π—Ç–∏?';
        return e.returnValue;
    }
});
</script>
</body>
</html>